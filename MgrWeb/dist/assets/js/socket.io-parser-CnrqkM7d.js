import{r as t}from"./@socket.io-mcuM6LAc.js";import{r as e}from"./debug-CmirTkX5.js";var r,n,o,c={},s={},i={};function a(){if(r)return i;r=1,Object.defineProperty(i,"__esModule",{value:!0}),i.hasBinary=i.isBinary=void 0;const t="function"==typeof ArrayBuffer,e=t=>"function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(t):t.buffer instanceof ArrayBuffer,n=Object.prototype.toString,o="function"==typeof Blob||"undefined"!=typeof Blob&&"[object BlobConstructor]"===n.call(Blob),c="function"==typeof File||"undefined"!=typeof File&&"[object FileConstructor]"===n.call(File);function s(r){return t&&(r instanceof ArrayBuffer||e(r))||o&&r instanceof Blob||c&&r instanceof File}return i.isBinary=s,i.hasBinary=function t(e,r){if(!e||"object"!=typeof e)return!1;if(Array.isArray(e)){for(let r=0,n=e.length;r<n;r++)if(t(e[r]))return!0;return!1}if(s(e))return!0;if(e.toJSON&&"function"==typeof e.toJSON&&1===arguments.length)return t(e.toJSON(),!0);for(const n in e)if(Object.prototype.hasOwnProperty.call(e,n)&&t(e[n]))return!0;return!1},i}function u(){if(n)return s;n=1,Object.defineProperty(s,"__esModule",{value:!0}),s.reconstructPacket=s.deconstructPacket=void 0;const t=a();function e(r,n){if(!r)return r;if((0,t.isBinary)(r)){const t={_placeholder:!0,num:n.length};return n.push(r),t}if(Array.isArray(r)){const t=new Array(r.length);for(let o=0;o<r.length;o++)t[o]=e(r[o],n);return t}if("object"==typeof r&&!(r instanceof Date)){const t={};for(const o in r)Object.prototype.hasOwnProperty.call(r,o)&&(t[o]=e(r[o],n));return t}return r}function r(t,e){if(!t)return t;if(t&&!0===t._placeholder){if("number"==typeof t.num&&t.num>=0&&t.num<e.length)return e[t.num];throw new Error("illegal attachments")}if(Array.isArray(t))for(let n=0;n<t.length;n++)t[n]=r(t[n],e);else if("object"==typeof t)for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&(t[n]=r(t[n],e));return t}return s.deconstructPacket=function(t){const r=[],n=t.data,o=t;return o.data=e(n,r),o.attachments=r.length,{packet:o,buffers:r}},s.reconstructPacket=function(t,e){return t.data=r(t.data,e),delete t.attachments,t},s}function f(){return o||(o=1,function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.Decoder=r.Encoder=r.PacketType=r.protocol=void 0;const n=t,o=u(),c=a(),s=(0,e().default)("socket.io-parser"),i=["connect","connect_error","disconnect","disconnecting","newListener","removeListener"];var f,l;r.protocol=5,(l=f=r.PacketType||(r.PacketType={}))[l.CONNECT=0]="CONNECT",l[l.DISCONNECT=1]="DISCONNECT",l[l.EVENT=2]="EVENT",l[l.ACK=3]="ACK",l[l.CONNECT_ERROR=4]="CONNECT_ERROR",l[l.BINARY_EVENT=5]="BINARY_EVENT",l[l.BINARY_ACK=6]="BINARY_ACK";function d(t){return"[object Object]"===Object.prototype.toString.call(t)}r.Encoder=class{constructor(t){this.replacer=t}encode(t){return s("encoding packet %j",t),t.type!==f.EVENT&&t.type!==f.ACK||!(0,c.hasBinary)(t)?[this.encodeAsString(t)]:this.encodeAsBinary({type:t.type===f.EVENT?f.BINARY_EVENT:f.BINARY_ACK,nsp:t.nsp,data:t.data,id:t.id})}encodeAsString(t){let e=""+t.type;return t.type!==f.BINARY_EVENT&&t.type!==f.BINARY_ACK||(e+=t.attachments+"-"),t.nsp&&"/"!==t.nsp&&(e+=t.nsp+","),null!=t.id&&(e+=t.id),null!=t.data&&(e+=JSON.stringify(t.data,this.replacer)),s("encoded %j as %s",t,e),e}encodeAsBinary(t){const e=(0,o.deconstructPacket)(t),r=this.encodeAsString(e.packet),n=e.buffers;return n.unshift(r),n}};class p extends n.Emitter{constructor(t){super(),this.reviver=t}add(t){let e;if("string"==typeof t){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");e=this.decodeString(t);const r=e.type===f.BINARY_EVENT;r||e.type===f.BINARY_ACK?(e.type=r?f.EVENT:f.ACK,this.reconstructor=new y(e),0===e.attachments&&super.emitReserved("decoded",e)):super.emitReserved("decoded",e)}else{if(!(0,c.isBinary)(t)&&!t.base64)throw new Error("Unknown type: "+t);if(!this.reconstructor)throw new Error("got binary data when not reconstructing a packet");e=this.reconstructor.takeBinaryData(t),e&&(this.reconstructor=null,super.emitReserved("decoded",e))}}decodeString(t){let e=0;const r={type:Number(t.charAt(0))};if(void 0===f[r.type])throw new Error("unknown packet type "+r.type);if(r.type===f.BINARY_EVENT||r.type===f.BINARY_ACK){const n=e+1;for(;"-"!==t.charAt(++e)&&e!=t.length;);const o=t.substring(n,e);if(o!=Number(o)||"-"!==t.charAt(e))throw new Error("Illegal attachments");r.attachments=Number(o)}if("/"===t.charAt(e+1)){const n=e+1;for(;++e;){if(","===t.charAt(e))break;if(e===t.length)break}r.nsp=t.substring(n,e)}else r.nsp="/";const n=t.charAt(e+1);if(""!==n&&Number(n)==n){const n=e+1;for(;++e;){const r=t.charAt(e);if(null==r||Number(r)!=r){--e;break}if(e===t.length)break}r.id=Number(t.substring(n,e+1))}if(t.charAt(++e)){const n=this.tryParse(t.substr(e));if(!p.isPayloadValid(r.type,n))throw new Error("invalid payload");r.data=n}return s("decoded %s as %j",t,r),r}tryParse(t){try{return JSON.parse(t,this.reviver)}catch(e){return!1}}static isPayloadValid(t,e){switch(t){case f.CONNECT:return d(e);case f.DISCONNECT:return void 0===e;case f.CONNECT_ERROR:return"string"==typeof e||d(e);case f.EVENT:case f.BINARY_EVENT:return Array.isArray(e)&&("number"==typeof e[0]||"string"==typeof e[0]&&-1===i.indexOf(e[0]));case f.ACK:case f.BINARY_ACK:return Array.isArray(e)}}destroy(){this.reconstructor&&(this.reconstructor.finishedReconstruction(),this.reconstructor=null)}}r.Decoder=p;class y{constructor(t){this.packet=t,this.buffers=[],this.reconPack=t}takeBinaryData(t){if(this.buffers.push(t),this.buffers.length===this.reconPack.attachments){const t=(0,o.reconstructPacket)(this.reconPack,this.buffers);return this.finishedReconstruction(),t}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}}(c)),c}export{f as r};
