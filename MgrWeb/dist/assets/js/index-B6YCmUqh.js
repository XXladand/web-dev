import{b as e}from"./vue-router-DCQgfElv.js";import{_ as a}from"./editTable.vue_vue_type_script_setup_true_name_sysEditTable_lang-Ct3vNejq.js";import{_ as t}from"./editColumn.vue_vue_type_script_setup_true_name_sysEditColumn_lang-Cje6kiyj.js";import{_ as l}from"./addTable.vue_vue_type_script_setup_true_name_sysAddTable_lang-tYc-xYoi.js";import{_ as o}from"./addColumn.vue_vue_type_script_setup_true_name_sysAddColumn_lang-CauMdaQ4.js";import{_ as i}from"./genEntity.vue_vue_type_script_setup_true_name_sysGenEntity_lang-BujTUYE_.js";import{_ as s}from"./genSeedData.vue_vue_type_script_setup_true_name_sysGenEntity_lang-YTZ5Qlm0.js";import{g as n}from"./index-DWGcUZYU.js";import{S as r}from"./sys-code-gen-api-BI7DgiUl.js";import{S as m}from"./sys-database-api-V52ZKqx1.js";import{E as p,c as d}from"./element-plus-B9gGnqkL.js";import{d as u,r as c,_ as f,j as b,ah as g,ap as y,o as _,c as v,V as j,P as N,Q as w,O as h,F as D,a8 as C,T as I}from"./@vue-CX_mlhJe.js";import"./database-CxmzcoGK.js";import"./lodash-es-Bx2dc0Qf.js";import"./pinia-CUaEdNPK.js";import"./vue-demi-DMxTsK9-.js";import"./vue-DMOwXDUL.js";import"./@babel-Q_QrznUx.js";import"./jspdf-CH-AZmyM.js";import"./fflate-B3Xb404m.js";import"./vue-i18n-DOLUIXgH.js";import"./@intlify-8Jop7_C0.js";import"./js-cookie-BXEMiIsG.js";import"./@element-plus-BOmeTCVz.js";import"./nprogress-BXoedg-7.js";import"./axios-CURSphCx.js";import"./mitt-CNZ6avp8.js";import"./vue-grid-layout-DUD0Qdrs.js";import"./vform3-builds-n_pM9nIF.js";import"./vue-signature-pad-lyh4QR3Z.js";import"./signature_pad-edH0THtw.js";import"./merge-images-Cwm9rL5U.js";import"./vue3-tree-org-BzkJto3m.js";/* empty css                    */import"./vue-plugin-hiprint-DZDwPE-S.js";import"./jquery-VSNIoD5U.js";import"./jsbarcode-BgYCXnWS.js";import"./socket.io-client-Czs-wWz3.js";import"./engine.io-client-CYjl6Vq_.js";import"./engine.io-parser-BcOgFIoq.js";import"./@socket.io-mcuM6LAc.js";import"./debug-CmirTkX5.js";import"./ms-CufoL-nS.js";import"./socket.io-parser-CnrqkM7d.js";import"./canvg-FiHv1N34.js";import"./core-js-BJmvCVxN.js";import"./raf-B8RiLMb0.js";import"./performance-now-D4QiMMAM.js";import"./rgbcolor-Cv9DR9SS.js";import"./svg-pathdata-BQypvdxQ.js";import"./stackblur-canvas-WbqePTkn.js";import"./@vueuse-DXufPiA3.js";import"./@sxzz-D3lHDW-0.js";import"./@ctrl-D2oWfImC.js";import"./dayjs-DCN6noHZ.js";import"./async-validator-Cuo4gI4y.js";import"./memoize-one-Ds0C_khL.js";import"./normalize-wheel-es-Vn5vHDCm.js";import"./@floating-ui-DHjS97uh.js";const k={class:"sys-database-container"},T=u({name:"sysDatabase"}),x=u({...T,setup(u){const T=c(),x=c(),P=c(),E=c(),S=c(),V=c(),G=e(),z=f({loading:!1,loading1:!1,dbData:[],configId:"",tableData:[],tableName:"",columnData:[],queryParams:{name:void 0,code:void 0},appNamespaces:[]});b((async()=>{z.loading=!0;var e=await n(m).apiSysDatabaseListGet();z.dbData=e.data.result,z.loading=!1;let a=await n(r).apiSysCodeGenApplicationNamespacesGet();z.appNamespaces=a.data.result}));const Q=e=>{R(),z.tableName=e,q()},R=async()=>{z.tableName="",z.columnData=[],z.loading=!0;let e=(await n(m).apiSysDatabaseTableListConfigIdGet(z.configId)).data.result??[];z.tableData=[],e.forEach((e=>{e.name.startsWith("zero_")||z.tableData.push(e)})),z.loading=!1},q=async()=>{if(z.columnData=[],""!=z.tableName&&void 0!==z.tableName){z.loading1=!0;var e=await n(m).apiSysDatabaseColumnListTableNameConfigIdGet(z.tableName,z.configId);z.columnData=e.data.result??[],z.loading1=!1}},B=()=>{var e;if(""!=z.configId&&""!=z.tableName){var a=z.tableData.filter((e=>e.name==z.tableName)),t={configId:z.configId,tableName:z.tableName,oldTableName:z.tableName,description:a[0].description};null==(e=T.value)||e.openDialog(t)}else p({type:"error",message:"请选择库名和表名!"})},A=()=>{var e;if(""!=z.configId&&""!=z.tableName){var a={configId:z.configId,tableName:z.tableName,position:z.appNamespaces[0]};null==(e=S.value)||e.openDialog(a)}else p({type:"error",message:"请选择库名和表名!"})},H=()=>{var e;if(""!=z.configId&&""!=z.tableName){var a={configId:z.configId,tableName:z.tableName,position:z.appNamespaces[0]};null==(e=V.value)||e.openDialog(a)}else p({type:"error",message:"请选择库名和表名!"})},L=()=>{var e;if(""!=z.configId){var a={configId:z.configId,tableName:"",oldTableName:"",description:""};null==(e=P.value)||e.openDialog(a)}else p({type:"error",message:"请选择库名!"})},$=()=>{var e;if(""==z.configId||""==z.tableName)return void p({type:"error",message:"请选择库名和表名!"});const a={configId:z.configId,tableName:z.tableName,columnDescription:"",dataType:"",dbColumnName:"",decimalDigits:0,isIdentity:0,isNullable:0,isPrimarykey:0,length:0};null==(e=E.value)||e.openDialog(a)},F=()=>{""!=z.tableName?d.confirm(`确定删除表：【${z.tableName}】?`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((async()=>{const e={configId:z.configId,tableName:z.tableName};await n(m).apiSysDatabaseDeleteTablePost(e),R(),p.success("表删除成功")})).catch((()=>{})):p({type:"error",message:"请选择表名!"})},U=()=>{""!=z.configId?G.push(`/develop/database/visual?configId=${z.configId}`):p({type:"error",message:"请选择库名!"})};return(e,r)=>{const u=g("el-option"),c=g("el-select"),f=g("el-form-item"),b=g("el-button"),G=g("el-button-group"),O=g("el-popover"),J=g("el-form"),K=g("el-card"),M=g("el-table-column"),W=g("el-tag"),X=g("el-table"),Y=y("loading");return _(),v("div",k,[j(K,{shadow:"hover","body-style":{paddingBottom:"0"}},{default:N((()=>[w((_(),h(J,{model:z.queryParams,ref:"queryForm",inline:!0},{default:N((()=>[j(f,{label:"库名"},{default:N((()=>[j(c,{modelValue:z.configId,"onUpdate:modelValue":r[0]||(r[0]=e=>z.configId=e),placeholder:"库名",filterable:"",onChange:R},{default:N((()=>[(_(!0),v(D,null,C(z.dbData,(e=>(_(),h(u,{key:e,label:e,value:e},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),j(f,{label:"表名"},{default:N((()=>[j(c,{modelValue:z.tableName,"onUpdate:modelValue":r[1]||(r[1]=e=>z.tableName=e),placeholder:"表名",filterable:"",clearable:"",onChange:q},{default:N((()=>[(_(!0),v(D,null,C(z.tableData,(e=>(_(),h(u,{key:e.name,label:e.name+"["+e.description+"]",value:e.name},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),j(f,null,{default:N((()=>[j(G,null,{default:N((()=>[j(b,{icon:"ele-Plus",type:"primary",onClick:L},{default:N((()=>[I(" 增加表 ")])),_:1}),j(b,{icon:"ele-Edit",onClick:B},{default:N((()=>[I(" 编辑表 ")])),_:1}),j(b,{icon:"ele-Delete",type:"danger",onClick:F,disabled:""},{default:N((()=>[I(" 删除表 ")])),_:1}),j(b,{icon:"ele-View",onClick:U},{default:N((()=>[I(" 可视化 ")])),_:1})])),_:1}),j(G,{style:{"padding-left":"10px"}},{default:N((()=>[j(b,{icon:"ele-Plus",onClick:$},{default:N((()=>[I(" 增加列 ")])),_:1}),j(b,{icon:"ele-Plus",onClick:A},{default:N((()=>[I(" 生成实体 ")])),_:1}),j(O,{placement:"bottom",title:"温馨提示",width:200,trigger:"hover",content:"如果是刚刚生成的实体，请重启服务后再生成种子"},{reference:N((()=>[j(b,{icon:"ele-Plus",onClick:H},{default:N((()=>[I(" 生成种子 ")])),_:1})])),_:1})])),_:1})])),_:1})])),_:1},8,["model"])),[[Y,z.loading]])])),_:1}),j(K,{class:"full-table",shadow:"hover",style:{"margin-top":"5px"}},{default:N((()=>[w((_(),h(X,{data:z.columnData,style:{width:"100%"},border:""},{default:N((()=>[j(M,{type:"index",label:"序号",width:"55",align:"center"}),j(M,{prop:"dbColumnName",label:"字段名",align:"center","show-overflow-tooltip":""}),j(M,{prop:"dataType",label:"数据类型",align:"center","show-overflow-tooltip":""}),j(M,{prop:"isPrimarykey",label:"主键",width:"70",align:"center","show-overflow-tooltip":""},{default:N((e=>[!0===e.row.isPrimarykey?(_(),h(W,{key:0,type:"success"},{default:N((()=>[I("是")])),_:1})):(_(),h(W,{key:1,type:"info"},{default:N((()=>[I("否")])),_:1}))])),_:1}),j(M,{prop:"isIdentity",label:"自增",width:"70",align:"center","show-overflow-tooltip":""},{default:N((e=>[!0===e.row.isIdentity?(_(),h(W,{key:0,type:"success"},{default:N((()=>[I("是")])),_:1})):(_(),h(W,{key:1,type:"info"},{default:N((()=>[I("否")])),_:1}))])),_:1}),j(M,{prop:"isNullable",label:"可空",width:"70",align:"center","show-overflow-tooltip":""},{default:N((e=>[!0===e.row.isNullable?(_(),h(W,{key:0},{default:N((()=>[I("是")])),_:1})):(_(),h(W,{key:1,type:"info"},{default:N((()=>[I("否")])),_:1}))])),_:1}),j(M,{prop:"length",label:"长度",width:"70",align:"center","show-overflow-tooltip":""}),j(M,{prop:"decimalDigits",label:"精度",width:"70",align:"center","show-overflow-tooltip":""}),j(M,{prop:"defaultValue",label:"默认值",align:"center","show-overflow-tooltip":""}),j(M,{prop:"columnDescription",label:"描述","header-align":"center","show-overflow-tooltip":""}),j(M,{label:"操作",width:"145",fixed:"right",align:"center","show-overflow-tooltip":""},{default:N((e=>[j(b,{icon:"ele-Edit",size:"small",text:"",type:"primary",onClick:a=>{return t=e.row,o={configId:z.configId,tableName:t.tableName,columnName:t.dbColumnName,oldColumnName:t.dbColumnName,description:t.columnDescription},void(null==(l=x.value)||l.openDialog(o));var t,l,o}},{default:N((()=>[I(" 编辑 ")])),_:2},1032,["onClick"]),j(b,{icon:"ele-Delete",size:"small",text:"",type:"danger",onClick:a=>{return t=e.row,void d.confirm(`确定删除列：【${t.dbColumnName}】?`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((async()=>{const e={configId:z.configId,tableName:z.tableName,dbColumnName:t.dbColumnName};await n(m).apiSysDatabaseDeleteColumnPost(e),R(),p.success("列删除成功")})).catch((()=>{}));var t}},{default:N((()=>[I(" 删除 ")])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"])),[[Y,z.loading1]])])),_:1}),j(a,{ref_key:"editTableRef",ref:T,onHandleQueryTable:R},null,512),j(t,{ref_key:"editColumnRef",ref:x,onHandleQueryColumn:q},null,512),j(l,{ref_key:"addTableRef",ref:P,onAddTableSubmitted:Q},null,512),j(o,{ref_key:"addColumnRef",ref:E,onHandleQueryColumn:q},null,512),j(i,{ref_key:"genEntityRef",ref:S,onHandleQueryColumn:q,"application-namespaces":z.appNamespaces},null,8,["application-namespaces"]),j(s,{ref_key:"genSeedDataRef",ref:V,"application-namespaces":z.appNamespaces},null,8,["application-namespaces"])])}}});export{x as default};
