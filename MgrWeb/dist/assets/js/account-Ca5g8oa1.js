const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./dragVerifyImgRotate-bTkivoYG.js","./@vue-CX_mlhJe.js","./_plugin-vue_export-helper-BCo6x5W8.js","../css/dragVerifyImgRotate-D_1cxF4p.css"])))=>i.map(i=>d[i]);
import{_ as e}from"./jspdf-CH-AZmyM.js";import{d as a,r as s,_ as o,j as t,Z as r,k as i,ah as l,ap as n,o as u,c,V as m,P as p,a9 as d,a as f,J as g,O as j,S as v,Q as y,U as h,u as b,F as _,aU as w}from"./@vue-CX_mlhJe.js";import{u as V,b as k}from"./vue-router-DCQgfElv.js";import{v as x}from"./vue-i18n-DOLUIXgH.js";import{u as I,g as P,S as E,L as F,m as R,b as S,n as L,p as U,N as T,f as q}from"./index-DWGcUZYU.js";import{a as C}from"./formatTime-V_I984Ws.js";import{s as A}from"./sm-crypto-v2-BPWIU65d.js";import{s as $}from"./pinia-CUaEdNPK.js";import{E as z}from"./element-plus-B9gGnqkL.js";import{_ as K}from"./_plugin-vue_export-helper-BCo6x5W8.js";import"./@babel-Q_QrznUx.js";import"./fflate-B3Xb404m.js";import"./@intlify-8Jop7_C0.js";import"./vue-DMOwXDUL.js";import"./js-cookie-BXEMiIsG.js";import"./@element-plus-BOmeTCVz.js";import"./nprogress-BXoedg-7.js";import"./axios-CURSphCx.js";import"./mitt-CNZ6avp8.js";import"./vue-grid-layout-DUD0Qdrs.js";import"./vform3-builds-n_pM9nIF.js";import"./vue-signature-pad-lyh4QR3Z.js";import"./signature_pad-edH0THtw.js";import"./merge-images-Cwm9rL5U.js";import"./vue3-tree-org-BzkJto3m.js";/* empty css                    */import"./vue-plugin-hiprint-DZDwPE-S.js";import"./jquery-VSNIoD5U.js";import"./jsbarcode-BgYCXnWS.js";import"./socket.io-client-Czs-wWz3.js";import"./engine.io-client-CYjl6Vq_.js";import"./engine.io-parser-BcOgFIoq.js";import"./@socket.io-mcuM6LAc.js";import"./debug-CmirTkX5.js";import"./ms-CufoL-nS.js";import"./socket.io-parser-CnrqkM7d.js";import"./canvg-FiHv1N34.js";import"./core-js-BJmvCVxN.js";import"./raf-B8RiLMb0.js";import"./performance-now-D4QiMMAM.js";import"./rgbcolor-Cv9DR9SS.js";import"./svg-pathdata-BQypvdxQ.js";import"./stackblur-canvas-WbqePTkn.js";import"./vue-demi-DMxTsK9-.js";import"./lodash-es-Bx2dc0Qf.js";import"./@vueuse-DXufPiA3.js";import"./@sxzz-D3lHDW-0.js";import"./@ctrl-D2oWfImC.js";import"./dayjs-DCN6noHZ.js";import"./async-validator-Cuo4gI4y.js";import"./memoize-one-Ds0C_khL.js";import"./normalize-wheel-es-Vn5vHDCm.js";import"./@floating-ui-DHjS97uh.js";import"./@noble-DPz6ZhRw.js";const D={class:"login-content-code"},O=["src"],G={class:"font12 mt30 login-animation4 login-msg"},M={class:"dialog-header"},N=a({name:"loginAccount"}),Q=K(a({...N,setup(a,{expose:K}){const N=w((()=>e((()=>import("./dragVerifyImgRotate-bTkivoYG.js")),__vite__mapDeps([0,1,2,3]),import.meta.url))),Q=I(),{themeConfig:B}=$(Q),{t:J}=x.useI18n(),Y=V(),Z=k(),H=s(),W=s(),X=s(),ee=s(),ae=s(null),se=o({isShowPassword:!1,ruleForm:{account:"",password:"",code:"",codeId:0},rules:{account:[{required:!0,message:"请输入用户名",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"}]},loading:{signIn:!1},captchaImage:"",rotateVerifyVisible:!1,rotateVerifyImg:B.value.logoUrl,secondVerEnabled:!1,captchaEnabled:!1,isPassRotate:!1,capsLockVisible:!1});t((async()=>{var e=Y.query.token;null!=e&&null!=e&&await le(e);var a=await P(E).apiSysAuthLoginConfigGet();se.secondVerEnabled=a.data.result.secondVerEnabled??!0,se.captchaEnabled=a.data.result.captchaEnabled??!0,te(),document.addEventListener("keyup",oe)})),r((()=>{document.removeEventListener("keyup",oe)}));const oe=e=>{const a=e.getModifierState("CapsLock");se.capsLockVisible=a},te=async()=>{var e,a;if(se.captchaEnabled){se.ruleForm.code="";var s=await P(E).apiSysAuthCaptchaGet();se.captchaImage="data:text/html;base64,"+(null==(e=s.data.result)?void 0:e.img),se.ruleForm.codeId=null==(a=s.data.result)?void 0:a.id}},re=i((()=>C(new Date))),ie=async()=>{H.value.validate((async e=>{var a,s;if(!e)return!1;try{se.loading.signIn=!0;const e=window.__env__.VITE_SM_PUBLIC_KEY,o=A.doEncrypt(se.ruleForm.password,e,1),[t,r]=await q(P(E).apiSysAuthLoginPost({...se.ruleForm,password:o}));if(t)return void te();if(null==(null==(a=r.data.result)?void 0:a.accessToken))return te(),void z.error("登录失败，请检查账号！");await le(null==(s=r.data.result)?void 0:s.accessToken)}finally{se.loading.signIn=!1}}))},le=async e=>{F.set(R,e),S.set("token",e);const a=await L();ne(a)},ne=e=>{var a,s,o,t;if(e)z.warning("抱歉，您没有登录权限"),U();else{let e=re.value;(null==(a=Y.query)?void 0:a.redirect)?Z.push({path:null==(s=Y.query)?void 0:s.redirect,query:Object.keys(null==(o=Y.query)?void 0:o.params).length>0?JSON.parse(null==(t=Y.query)?void 0:t.params):""}):Z.push("/");const r=J("message.signInText");z.success(`${e}，${r}`),T.start()}},ue=()=>{se.rotateVerifyVisible=!1,se.isPassRotate=!0,ie()},ce=()=>{var e,a,s;se.ruleForm.account?se.ruleForm.password?se.captchaEnabled&&!se.ruleForm.code?null==(s=ee.value)||s.focus():se.secondVerEnabled?(()=>{var e;se.rotateVerifyVisible=!0,se.isPassRotate=!1,null==(e=ae.value)||e.reset()})():ie():null==(a=X.value)||a.focus():null==(e=W.value)||e.focus()};return K({saveTokenAndInitRoutes:le}),(e,a)=>{const s=l("ele-User"),o=l("el-icon"),t=l("el-input"),r=l("el-form-item"),i=l("ele-Unlock"),w=l("ele-Position"),V=l("el-col"),k=l("el-button"),x=l("el-form"),I=l("el-tooltip"),P=l("el-dialog"),E=n("waves");return u(),c(_,null,[m(I,{visible:se.capsLockVisible,effect:"light",content:"大写锁定已打开",placement:"top"},{default:p((()=>[m(x,{ref_key:"ruleFormRef",ref:H,model:se.ruleForm,size:"large",rules:se.rules,class:"login-content-form"},{default:p((()=>[m(r,{class:"login-animation1",prop:"account"},{default:p((()=>[m(t,{ref_key:"accountRef",ref:W,text:"",placeholder:"请输入账号",modelValue:se.ruleForm.account,"onUpdate:modelValue":a[0]||(a[0]=e=>se.ruleForm.account=e),clearable:"",autocomplete:"off",onKeyup:d(ce,["enter","native"])},{prefix:p((()=>[m(o,null,{default:p((()=>[m(s)])),_:1})])),_:1},8,["modelValue"])])),_:1}),m(r,{class:"login-animation2",prop:"password"},{default:p((()=>[m(t,{ref_key:"passwordRef",ref:X,type:se.isShowPassword?"text":"password",placeholder:"请输入密码",modelValue:se.ruleForm.password,"onUpdate:modelValue":a[2]||(a[2]=e=>se.ruleForm.password=e),autocomplete:"off",onKeyup:d(ce,["enter","native"])},{prefix:p((()=>[m(o,null,{default:p((()=>[m(i)])),_:1})])),suffix:p((()=>[f("i",{class:g(["iconfont el-input__icon login-content-password",se.isShowPassword?"icon-yincangmima":"icon-xianshimima"]),onClick:a[1]||(a[1]=e=>se.isShowPassword=!se.isShowPassword)},null,2)])),_:1},8,["type","modelValue"])])),_:1}),se.captchaEnabled?(u(),j(r,{key:0,class:"login-animation3",prop:"captcha"},{default:p((()=>[m(V,{span:15},{default:p((()=>[m(t,{ref_key:"codeRef",ref:ee,text:"",maxlength:"4",placeholder:e.$t("message.account.accountPlaceholder3"),modelValue:se.ruleForm.code,"onUpdate:modelValue":a[3]||(a[3]=e=>se.ruleForm.code=e),clearable:"",autocomplete:"off",onKeyup:d(ce,["enter","native"])},{prefix:p((()=>[m(o,null,{default:p((()=>[m(w)])),_:1})])),_:1},8,["placeholder","modelValue"])])),_:1}),m(V,{span:1}),m(V,{span:8},{default:p((()=>[f("div",D,[f("img",{class:"login-content-code-img",onClick:te,width:"130px",height:"38px",src:se.captchaImage,style:{cursor:"pointer"}},null,8,O)])])),_:1})])),_:1})):v("",!0),m(r,{class:"login-animation4"},{default:p((()=>[y((u(),j(k,{type:"primary",class:"login-content-submit",round:"",onClick:ce,loading:se.loading.signIn},{default:p((()=>[f("span",null,h(e.$t("message.account.accountBtnText")),1)])),_:1},8,["loading"])),[[E]])])),_:1}),f("div",G,h(e.$t("message.mobile.msgText")),1)])),_:1},8,["model","rules"])])),_:1},8,["visible"]),f("div",M,[m(P,{modelValue:se.rotateVerifyVisible,"onUpdate:modelValue":a[5]||(a[5]=e=>se.rotateVerifyVisible=e),"show-close":!1},{default:p((()=>[m(b(N),{ref_key:"dragRef",ref:ae,imgsrc:se.rotateVerifyImg,isPassing:se.isPassRotate,"onUpdate:isPassing":a[4]||(a[4]=e=>se.isPassRotate=e),text:"请按住滑块拖动",successText:"验证通过",handlerIcon:"fa fa-angle-double-right",successIcon:"fa fa-hand-peace-o",onPasscallback:ue},null,8,["imgsrc","isPassing"])])),_:1},8,["modelValue"])])],64)}}}),[["__scopeId","data-v-9b895d3e"]]);export{Q as default};
