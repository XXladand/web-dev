import{c as e}from"./@babel-Q_QrznUx.js";import{r as t}from"./engine.io-parser-BcOgFIoq.js";import{r as s}from"./@socket.io-mcuM6LAc.js";import{r}from"./debug-CmirTkX5.js";var o,i,n={},a={},h={},p={},c={},l={},u={};function d(){return o||(o=1,Object.defineProperty(u,"__esModule",{value:!0}),u.globalThisShim=void 0,u.globalThisShim="undefined"!=typeof self?self:"undefined"!=typeof window?window:Function("return this")()),u}function f(){if(i)return l;i=1,Object.defineProperty(l,"__esModule",{value:!0}),l.byteLength=l.installTimerFunctions=l.pick=void 0;const e=d();l.pick=function(e,...t){return t.reduce(((t,s)=>(e.hasOwnProperty(s)&&(t[s]=e[s]),t)),{})};const t=e.globalThisShim.setTimeout,s=e.globalThisShim.clearTimeout;l.installTimerFunctions=function(r,o){o.useNativeTimers?(r.setTimeoutFn=t.bind(e.globalThisShim),r.clearTimeoutFn=s.bind(e.globalThisShim)):(r.setTimeoutFn=e.globalThisShim.setTimeout.bind(e.globalThisShim),r.clearTimeoutFn=e.globalThisShim.clearTimeout.bind(e.globalThisShim))};return l.byteLength=function(e){return"string"==typeof e?function(e){let t=0,s=0;for(let r=0,o=e.length;r<o;r++)t=e.charCodeAt(r),t<128?s+=1:t<2048?s+=2:t<55296||t>=57344?s+=3:(r++,s+=4);return s}(e):Math.ceil(1.33*(e.byteLength||e.size))},l}var g,m,y={};function b(){if(g)return y;return g=1,Object.defineProperty(y,"__esModule",{value:!0}),y.decode=y.encode=void 0,y.encode=function(e){let t="";for(let s in e)e.hasOwnProperty(s)&&(t.length&&(t+="&"),t+=encodeURIComponent(s)+"="+encodeURIComponent(e[s]));return t},y.decode=function(e){let t={},s=e.split("&");for(let r=0,o=s.length;r<o;r++){let e=s[r].split("=");t[decodeURIComponent(e[0])]=decodeURIComponent(e[1])}return t},y}function v(){if(m)return c;m=1;var o=e&&e.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(c,"__esModule",{value:!0}),c.Transport=c.TransportError=void 0;const i=t(),n=s,a=f(),h=o(r()),p=b(),l=(0,h.default)("engine.io-client:transport");class u extends Error{constructor(e,t,s){super(e),this.description=t,this.context=s,this.type="TransportError"}}c.TransportError=u;class d extends n.Emitter{constructor(e){super(),this.writable=!1,(0,a.installTimerFunctions)(this,e),this.opts=e,this.query=e.query,this.socket=e.socket}onError(e,t,s){return super.emitReserved("error",new u(e,t,s)),this}open(){return this.readyState="opening",this.doOpen(),this}close(){return"opening"!==this.readyState&&"open"!==this.readyState||(this.doClose(),this.onClose()),this}send(e){"open"===this.readyState?this.write(e):l("transport is not open, discarding packets")}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(e){const t=(0,i.decodePacket)(e,this.socket.binaryType);this.onPacket(t)}onPacket(e){super.emitReserved("packet",e)}onClose(e){this.readyState="closed",super.emitReserved("close",e)}pause(e){}createUri(e,t={}){return e+"://"+this._hostname()+this._port()+this.opts.path+this._query(t)}_hostname(){const e=this.opts.hostname;return-1===e.indexOf(":")?e:"["+e+"]"}_port(){return this.opts.port&&(this.opts.secure&&Number(443!==this.opts.port)||!this.opts.secure&&80!==Number(this.opts.port))?":"+this.opts.port:""}_query(e){const t=(0,p.encode)(e);return t.length?"?"+t:""}}return c.Transport=d,c}var w,k={};function T(){if(w)return k;w=1,Object.defineProperty(k,"__esModule",{value:!0}),k.yeast=k.decode=k.encode=void 0;const e="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),t=64,s={};let r,o=0,i=0;function n(s){let r="";do{r=e[s%t]+r,s=Math.floor(s/t)}while(s>0);return r}for(k.encode=n,k.decode=function(e){let r=0;for(i=0;i<e.length;i++)r=r*t+s[e.charAt(i)];return r},k.yeast=function(){const e=n(+new Date);return e!==r?(o=0,r=e):e+"."+n(o++)};i<t;i++)s[e[i]]=i;return k}var S,P,x,O={},_={};function R(){if(P)return O;P=1,Object.defineProperty(O,"__esModule",{value:!0}),O.createCookieJar=O.XHR=void 0;const e=function(){if(S)return _;S=1,Object.defineProperty(_,"__esModule",{value:!0}),_.hasCORS=void 0;let e=!1;try{e="undefined"!=typeof XMLHttpRequest&&"withCredentials"in new XMLHttpRequest}catch(t){}return _.hasCORS=e,_}(),t=d();return O.XHR=function(s){const r=s.xdomain;try{if("undefined"!=typeof XMLHttpRequest&&(!r||e.hasCORS))return new XMLHttpRequest}catch(o){}if(!r)try{return new(t.globalThisShim[["Active"].concat("Object").join("X")])("Microsoft.XMLHTTP")}catch(o){}},O.createCookieJar=function(){},O}var E,q,C={},L={};function B(){if(E)return L;E=1,Object.defineProperty(L,"__esModule",{value:!0}),L.defaultBinaryType=L.usingBrowserWebSocket=L.WebSocket=L.nextTick=void 0;const e=d();return L.nextTick="function"==typeof Promise&&"function"==typeof Promise.resolve?e=>Promise.resolve().then(e):(e,t)=>t(e,0),L.WebSocket=e.globalThisShim.WebSocket||e.globalThisShim.MozWebSocket,L.usingBrowserWebSocket=!0,L.defaultBinaryType="arraybuffer",L}var j,M,W={};function F(){if(M)return h;M=1,Object.defineProperty(h,"__esModule",{value:!0}),h.transports=void 0;const o=function(){if(x)return p;x=1;var o=e&&e.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(p,"__esModule",{value:!0}),p.Request=p.Polling=void 0;const i=v(),n=o(r()),a=T(),h=t(),c=R(),l=s,u=f(),g=d(),m=(0,n.default)("engine.io-client:polling");function y(){}const b=null!=new c.XHR({xdomain:!1}).responseType;class w extends i.Transport{constructor(e){if(super(e),this.polling=!1,"undefined"!=typeof location){const t="https:"===location.protocol;let s=location.port;s||(s=t?"443":"80"),this.xd="undefined"!=typeof location&&e.hostname!==location.hostname||s!==e.port}const t=e&&e.forceBase64;this.supportsBinary=b&&!t,this.opts.withCredentials&&(this.cookieJar=(0,c.createCookieJar)())}get name(){return"polling"}doOpen(){this.poll()}pause(e){this.readyState="pausing";const t=()=>{m("paused"),this.readyState="paused",e()};if(this.polling||!this.writable){let e=0;this.polling&&(m("we are currently polling - waiting to pause"),e++,this.once("pollComplete",(function(){m("pre-pause polling complete"),--e||t()}))),this.writable||(m("we are currently writing - waiting to pause"),e++,this.once("drain",(function(){m("pre-pause writing complete"),--e||t()})))}else t()}poll(){m("polling"),this.polling=!0,this.doPoll(),this.emitReserved("poll")}onData(e){m("polling got data %s",e),(0,h.decodePayload)(e,this.socket.binaryType).forEach((e=>{if("opening"===this.readyState&&"open"===e.type&&this.onOpen(),"close"===e.type)return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(e)})),"closed"!==this.readyState&&(this.polling=!1,this.emitReserved("pollComplete"),"open"===this.readyState?this.poll():m('ignoring poll - transport state "%s"',this.readyState))}doClose(){const e=()=>{m("writing close packet"),this.write([{type:"close"}])};"open"===this.readyState?(m("transport open - closing"),e()):(m("transport not open - deferring close"),this.once("open",e))}write(e){this.writable=!1,(0,h.encodePayload)(e,(e=>{this.doWrite(e,(()=>{this.writable=!0,this.emitReserved("drain")}))}))}uri(){const e=this.opts.secure?"https":"http",t=this.query||{};return!1!==this.opts.timestampRequests&&(t[this.opts.timestampParam]=(0,a.yeast)()),this.supportsBinary||t.sid||(t.b64=1),this.createUri(e,t)}request(e={}){return Object.assign(e,{xd:this.xd,cookieJar:this.cookieJar},this.opts),new k(this.uri(),e)}doWrite(e,t){const s=this.request({method:"POST",data:e});s.on("success",t),s.on("error",((e,t)=>{this.onError("xhr post error",e,t)}))}doPoll(){m("xhr poll");const e=this.request();e.on("data",this.onData.bind(this)),e.on("error",((e,t)=>{this.onError("xhr poll error",e,t)})),this.pollXhr=e}}p.Polling=w;class k extends l.Emitter{constructor(e,t){super(),(0,u.installTimerFunctions)(this,t),this.opts=t,this.method=t.method||"GET",this.uri=e,this.data=void 0!==t.data?t.data:null,this.create()}create(){var e;const t=(0,u.pick)(this.opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");t.xdomain=!!this.opts.xd;const s=this.xhr=new c.XHR(t);try{m("xhr open %s: %s",this.method,this.uri),s.open(this.method,this.uri,!0);try{if(this.opts.extraHeaders){s.setDisableHeaderCheck&&s.setDisableHeaderCheck(!0);for(let e in this.opts.extraHeaders)this.opts.extraHeaders.hasOwnProperty(e)&&s.setRequestHeader(e,this.opts.extraHeaders[e])}}catch(r){}if("POST"===this.method)try{s.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch(r){}try{s.setRequestHeader("Accept","*/*")}catch(r){}null===(e=this.opts.cookieJar)||void 0===e||e.addCookies(s),"withCredentials"in s&&(s.withCredentials=this.opts.withCredentials),this.opts.requestTimeout&&(s.timeout=this.opts.requestTimeout),s.onreadystatechange=()=>{var e;3===s.readyState&&(null===(e=this.opts.cookieJar)||void 0===e||e.parseCookies(s)),4===s.readyState&&(200===s.status||1223===s.status?this.onLoad():this.setTimeoutFn((()=>{this.onError("number"==typeof s.status?s.status:0)}),0))},m("xhr data %s",this.data),s.send(this.data)}catch(r){return void this.setTimeoutFn((()=>{this.onError(r)}),0)}"undefined"!=typeof document&&(this.index=k.requestsCount++,k.requests[this.index]=this)}onError(e){this.emitReserved("error",e,this.xhr),this.cleanup(!0)}cleanup(e){if(void 0!==this.xhr&&null!==this.xhr){if(this.xhr.onreadystatechange=y,e)try{this.xhr.abort()}catch(t){}"undefined"!=typeof document&&delete k.requests[this.index],this.xhr=null}}onLoad(){const e=this.xhr.responseText;null!==e&&(this.emitReserved("data",e),this.emitReserved("success"),this.cleanup())}abort(){this.cleanup()}}if(p.Request=k,k.requestsCount=0,k.requests={},"undefined"!=typeof document)if("function"==typeof attachEvent)attachEvent("onunload",S);else if("function"==typeof addEventListener){const e="onpagehide"in g.globalThisShim?"pagehide":"unload";addEventListener(e,S,!1)}function S(){for(let e in k.requests)k.requests.hasOwnProperty(e)&&k.requests[e].abort()}return p}(),i=function(){if(q)return C;q=1;var s=e&&e.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(C,"__esModule",{value:!0}),C.WS=void 0;const o=v(),i=T(),n=f(),a=B(),h=s(r()),p=t(),c=(0,h.default)("engine.io-client:websocket"),l="undefined"!=typeof navigator&&"string"==typeof navigator.product&&"reactnative"===navigator.product.toLowerCase();class u extends o.Transport{constructor(e){super(e),this.supportsBinary=!e.forceBase64}get name(){return"websocket"}doOpen(){if(!this.check())return;const e=this.uri(),t=this.opts.protocols,s=l?{}:(0,n.pick)(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(s.headers=this.opts.extraHeaders);try{this.ws=a.usingBrowserWebSocket&&!l?t?new a.WebSocket(e,t):new a.WebSocket(e):new a.WebSocket(e,t,s)}catch(r){return this.emitReserved("error",r)}this.ws.binaryType=this.socket.binaryType,this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=e=>this.onClose({description:"websocket connection closed",context:e}),this.ws.onmessage=e=>this.onData(e.data),this.ws.onerror=e=>this.onError("websocket error",e)}write(e){this.writable=!1;for(let t=0;t<e.length;t++){const s=e[t],r=t===e.length-1;(0,p.encodePacket)(s,this.supportsBinary,(e=>{const t={};!a.usingBrowserWebSocket&&(s.options&&(t.compress=s.options.compress),this.opts.perMessageDeflate)&&("string"==typeof e?Buffer.byteLength(e):e.length)<this.opts.perMessageDeflate.threshold&&(t.compress=!1);try{a.usingBrowserWebSocket?this.ws.send(e):this.ws.send(e,t)}catch(o){c("websocket closed before onclose event")}r&&(0,a.nextTick)((()=>{this.writable=!0,this.emitReserved("drain")}),this.setTimeoutFn)}))}}doClose(){void 0!==this.ws&&(this.ws.close(),this.ws=null)}uri(){const e=this.opts.secure?"wss":"ws",t=this.query||{};return this.opts.timestampRequests&&(t[this.opts.timestampParam]=(0,i.yeast)()),this.supportsBinary||(t.b64=1),this.createUri(e,t)}check(){return!!a.WebSocket}}return C.WS=u,C}(),n=function(){if(j)return W;j=1;var s=e&&e.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(W,"__esModule",{value:!0}),W.WT=void 0;const o=v(),i=B(),n=t(),a=(0,s(r()).default)("engine.io-client:webtransport");class h extends o.Transport{get name(){return"webtransport"}doOpen(){"function"==typeof WebTransport&&(this.transport=new WebTransport(this.createUri("https"),this.opts.transportOptions[this.name]),this.transport.closed.then((()=>{a("transport closed gracefully"),this.onClose()})).catch((e=>{a("transport closed due to %s",e),this.onError("webtransport error",e)})),this.transport.ready.then((()=>{this.transport.createBidirectionalStream().then((e=>{const t=(0,n.createPacketDecoderStream)(Number.MAX_SAFE_INTEGER,this.socket.binaryType),s=e.readable.pipeThrough(t).getReader(),r=(0,n.createPacketEncoderStream)();r.readable.pipeTo(e.writable),this.writer=r.writable.getWriter();const o=()=>{s.read().then((({done:e,value:t})=>{e?a("session is closed"):(a("received chunk: %o",t),this.onPacket(t),o())})).catch((e=>{a("an error occurred while reading: %s",e)}))};o();const i={type:"open"};this.query.sid&&(i.data=`{"sid":"${this.query.sid}"}`),this.writer.write(i).then((()=>this.onOpen()))}))})))}write(e){this.writable=!1;for(let t=0;t<e.length;t++){const s=e[t],r=t===e.length-1;this.writer.write(s).then((()=>{r&&(0,i.nextTick)((()=>{this.writable=!0,this.emitReserved("drain")}),this.setTimeoutFn)}))}}doClose(){var e;null===(e=this.transport)||void 0===e||e.close()}}return W.WT=h,W}();return h.transports={websocket:i.WS,webtransport:n.WT,polling:o.Polling},h}var H,U,D,I={};function X(){if(H)return I;H=1,Object.defineProperty(I,"__esModule",{value:!0}),I.parse=void 0;const e=/^(?:(?![^:@\/?#]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@\/?#]*)(?::([^:@\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,t=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];return I.parse=function(s){if(s.length>2e3)throw"URI too long";const r=s,o=s.indexOf("["),i=s.indexOf("]");-1!=o&&-1!=i&&(s=s.substring(0,o)+s.substring(o,i).replace(/:/g,";")+s.substring(i,s.length));let n=e.exec(s||""),a={},h=14;for(;h--;)a[t[h]]=n[h]||"";return-1!=o&&-1!=i&&(a.source=r,a.host=a.host.substring(1,a.host.length-1).replace(/;/g,":"),a.authority=a.authority.replace("[","").replace("]","").replace(/;/g,":"),a.ipv6uri=!0),a.pathNames=function(e,t){const s=/\/{2,9}/g,r=t.replace(s,"/").split("/");"/"!=t.slice(0,1)&&0!==t.length||r.splice(0,1);"/"==t.slice(-1)&&r.splice(r.length-1,1);return r}(0,a.path),a.queryKey=function(e,t){const s={};return t.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,(function(e,t,r){t&&(s[t]=r)})),s}(0,a.query),a},I}function A(){return D||(D=1,function(o){Object.defineProperty(o,"__esModule",{value:!0}),o.nextTick=o.parse=o.installTimerFunctions=o.transports=o.TransportError=o.Transport=o.protocol=o.Socket=void 0;const i=function(){if(U)return a;U=1;var o=e&&e.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(a,"__esModule",{value:!0}),a.Socket=void 0;const i=F(),n=f(),h=b(),p=X(),c=o(r()),l=s,u=t(),d=B(),g=(0,c.default)("engine.io-client:socket");class m extends l.Emitter{constructor(e,t={}){super(),this.binaryType=d.defaultBinaryType,this.writeBuffer=[],e&&"object"==typeof e&&(t=e,e=null),e?(e=(0,p.parse)(e),t.hostname=e.host,t.secure="https"===e.protocol||"wss"===e.protocol,t.port=e.port,e.query&&(t.query=e.query)):t.host&&(t.hostname=(0,p.parse)(t.host).host),(0,n.installTimerFunctions)(this,t),this.secure=null!=t.secure?t.secure:"undefined"!=typeof location&&"https:"===location.protocol,t.hostname&&!t.port&&(t.port=this.secure?"443":"80"),this.hostname=t.hostname||("undefined"!=typeof location?location.hostname:"localhost"),this.port=t.port||("undefined"!=typeof location&&location.port?location.port:this.secure?"443":"80"),this.transports=t.transports||["polling","websocket","webtransport"],this.writeBuffer=[],this.prevBufferLen=0,this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,addTrailingSlash:!0,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!1},t),this.opts.path=this.opts.path.replace(/\/$/,"")+(this.opts.addTrailingSlash?"/":""),"string"==typeof this.opts.query&&(this.opts.query=(0,h.decode)(this.opts.query)),this.id=null,this.upgrades=null,this.pingInterval=null,this.pingTimeout=null,this.pingTimeoutTimer=null,"function"==typeof addEventListener&&(this.opts.closeOnBeforeunload&&(this.beforeunloadEventListener=()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},addEventListener("beforeunload",this.beforeunloadEventListener,!1)),"localhost"!==this.hostname&&(this.offlineEventListener=()=>{this.onClose("transport close",{description:"network connection lost"})},addEventListener("offline",this.offlineEventListener,!1))),this.open()}createTransport(e){g('creating transport "%s"',e);const t=Object.assign({},this.opts.query);t.EIO=u.protocol,t.transport=e,this.id&&(t.sid=this.id);const s=Object.assign({},this.opts,{query:t,socket:this,hostname:this.hostname,secure:this.secure,port:this.port},this.opts.transportOptions[e]);return g("options: %j",s),new i.transports[e](s)}open(){let e;if(this.opts.rememberUpgrade&&m.priorWebsocketSuccess&&-1!==this.transports.indexOf("websocket"))e="websocket";else{if(0===this.transports.length)return void this.setTimeoutFn((()=>{this.emitReserved("error","No transports available")}),0);e=this.transports[0]}this.readyState="opening";try{e=this.createTransport(e)}catch(t){return g("error while creating transport: %s",t),this.transports.shift(),void this.open()}e.open(),this.setTransport(e)}setTransport(e){g("setting transport %s",e.name),this.transport&&(g("clearing existing transport %s",this.transport.name),this.transport.removeAllListeners()),this.transport=e,e.on("drain",this.onDrain.bind(this)).on("packet",this.onPacket.bind(this)).on("error",this.onError.bind(this)).on("close",(e=>this.onClose("transport close",e)))}probe(e){g('probing transport "%s"',e);let t=this.createTransport(e),s=!1;m.priorWebsocketSuccess=!1;const r=()=>{s||(g('probe transport "%s" opened',e),t.send([{type:"ping",data:"probe"}]),t.once("packet",(r=>{if(!s)if("pong"===r.type&&"probe"===r.data){if(g('probe transport "%s" pong',e),this.upgrading=!0,this.emitReserved("upgrading",t),!t)return;m.priorWebsocketSuccess="websocket"===t.name,g('pausing current transport "%s"',this.transport.name),this.transport.pause((()=>{s||"closed"!==this.readyState&&(g("changing transport and sending upgrade packet"),p(),this.setTransport(t),t.send([{type:"upgrade"}]),this.emitReserved("upgrade",t),t=null,this.upgrading=!1,this.flush())}))}else{g('probe transport "%s" failed',e);const s=new Error("probe error");s.transport=t.name,this.emitReserved("upgradeError",s)}})))};function o(){s||(s=!0,p(),t.close(),t=null)}const i=s=>{const r=new Error("probe error: "+s);r.transport=t.name,o(),g('probe transport "%s" failed because of error: %s',e,s),this.emitReserved("upgradeError",r)};function n(){i("transport closed")}function a(){i("socket closed")}function h(e){t&&e.name!==t.name&&(g('"%s" works - aborting "%s"',e.name,t.name),o())}const p=()=>{t.removeListener("open",r),t.removeListener("error",i),t.removeListener("close",n),this.off("close",a),this.off("upgrading",h)};t.once("open",r),t.once("error",i),t.once("close",n),this.once("close",a),this.once("upgrading",h),-1!==this.upgrades.indexOf("webtransport")&&"webtransport"!==e?this.setTimeoutFn((()=>{s||t.open()}),200):t.open()}onOpen(){if(g("socket open"),this.readyState="open",m.priorWebsocketSuccess="websocket"===this.transport.name,this.emitReserved("open"),this.flush(),"open"===this.readyState&&this.opts.upgrade){g("starting upgrade probes");let e=0;const t=this.upgrades.length;for(;e<t;e++)this.probe(this.upgrades[e])}}onPacket(e){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState)switch(g('socket receive: type "%s", data "%s"',e.type,e.data),this.emitReserved("packet",e),this.emitReserved("heartbeat"),this.resetPingTimeout(),e.type){case"open":this.onHandshake(JSON.parse(e.data));break;case"ping":this.sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong");break;case"error":const t=new Error("server error");t.code=e.data,this.onError(t);break;case"message":this.emitReserved("data",e.data),this.emitReserved("message",e.data)}else g('packet received with socket readyState "%s"',this.readyState)}onHandshake(e){this.emitReserved("handshake",e),this.id=e.sid,this.transport.query.sid=e.sid,this.upgrades=this.filterUpgrades(e.upgrades),this.pingInterval=e.pingInterval,this.pingTimeout=e.pingTimeout,this.maxPayload=e.maxPayload,this.onOpen(),"closed"!==this.readyState&&this.resetPingTimeout()}resetPingTimeout(){this.clearTimeoutFn(this.pingTimeoutTimer),this.pingTimeoutTimer=this.setTimeoutFn((()=>{this.onClose("ping timeout")}),this.pingInterval+this.pingTimeout),this.opts.autoUnref&&this.pingTimeoutTimer.unref()}onDrain(){this.writeBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,0===this.writeBuffer.length?this.emitReserved("drain"):this.flush()}flush(){if("closed"!==this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){const e=this.getWritablePackets();g("flushing %d packets in socket",e.length),this.transport.send(e),this.prevBufferLen=e.length,this.emitReserved("flush")}}getWritablePackets(){if(!(this.maxPayload&&"polling"===this.transport.name&&this.writeBuffer.length>1))return this.writeBuffer;let e=1;for(let t=0;t<this.writeBuffer.length;t++){const s=this.writeBuffer[t].data;if(s&&(e+=(0,n.byteLength)(s)),t>0&&e>this.maxPayload)return g("only send %d out of %d packets",t,this.writeBuffer.length),this.writeBuffer.slice(0,t);e+=2}return g("payload size is %d (max: %d)",e,this.maxPayload),this.writeBuffer}write(e,t,s){return this.sendPacket("message",e,t,s),this}send(e,t,s){return this.sendPacket("message",e,t,s),this}sendPacket(e,t,s,r){if("function"==typeof t&&(r=t,t=void 0),"function"==typeof s&&(r=s,s=null),"closing"===this.readyState||"closed"===this.readyState)return;(s=s||{}).compress=!1!==s.compress;const o={type:e,data:t,options:s};this.emitReserved("packetCreate",o),this.writeBuffer.push(o),r&&this.once("flush",r),this.flush()}close(){const e=()=>{this.onClose("forced close"),g("socket closing - telling transport to close"),this.transport.close()},t=()=>{this.off("upgrade",t),this.off("upgradeError",t),e()},s=()=>{this.once("upgrade",t),this.once("upgradeError",t)};return"opening"!==this.readyState&&"open"!==this.readyState||(this.readyState="closing",this.writeBuffer.length?this.once("drain",(()=>{this.upgrading?s():e()})):this.upgrading?s():e()),this}onError(e){g("socket error %j",e),m.priorWebsocketSuccess=!1,this.emitReserved("error",e),this.onClose("transport error",e)}onClose(e,t){"opening"!==this.readyState&&"open"!==this.readyState&&"closing"!==this.readyState||(g('socket close with reason: "%s"',e),this.clearTimeoutFn(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),"function"==typeof removeEventListener&&(removeEventListener("beforeunload",this.beforeunloadEventListener,!1),removeEventListener("offline",this.offlineEventListener,!1)),this.readyState="closed",this.id=null,this.emitReserved("close",e,t),this.writeBuffer=[],this.prevBufferLen=0)}filterUpgrades(e){const t=[];let s=0;const r=e.length;for(;s<r;s++)~this.transports.indexOf(e[s])&&t.push(e[s]);return t}}return a.Socket=m,m.protocol=u.protocol,a}();Object.defineProperty(o,"Socket",{enumerable:!0,get:function(){return i.Socket}}),o.protocol=i.Socket.protocol;var n=v();Object.defineProperty(o,"Transport",{enumerable:!0,get:function(){return n.Transport}}),Object.defineProperty(o,"TransportError",{enumerable:!0,get:function(){return n.TransportError}});var h=F();Object.defineProperty(o,"transports",{enumerable:!0,get:function(){return h.transports}});var p=f();Object.defineProperty(o,"installTimerFunctions",{enumerable:!0,get:function(){return p.installTimerFunctions}});var c=X();Object.defineProperty(o,"parse",{enumerable:!0,get:function(){return c.parse}});var l=B();Object.defineProperty(o,"nextTick",{enumerable:!0,get:function(){return l.nextTick}})}(n)),n}export{A as r};
