import{d as e,_ as a,j as t,ah as s,ap as o,o as r,c as i,V as n,P as l,a9 as p,T as m,Q as c,O as u}from"./@vue-CX_mlhJe.js";import{B as d,j as f,g as h,S as g,y as j}from"./index-DWGcUZYU.js";import{a as y}from"./axios-CURSphCx.js";import{c as P}from"./signalR-D9h6ejlC.js";import{t as b}from"./lodash-es-Bx2dc0Qf.js";import{c as w,e as U}from"./element-plus-B9gGnqkL.js";import"./pinia-CUaEdNPK.js";import"./vue-demi-DMxTsK9-.js";import"./vue-DMOwXDUL.js";import"./@babel-Q_QrznUx.js";import"./jspdf-CH-AZmyM.js";import"./fflate-B3Xb404m.js";import"./vue-router-DCQgfElv.js";import"./vue-i18n-DOLUIXgH.js";import"./@intlify-8Jop7_C0.js";import"./js-cookie-BXEMiIsG.js";import"./@element-plus-BOmeTCVz.js";import"./nprogress-BXoedg-7.js";import"./mitt-CNZ6avp8.js";import"./vue-grid-layout-DUD0Qdrs.js";import"./vform3-builds-n_pM9nIF.js";import"./vue-signature-pad-lyh4QR3Z.js";import"./signature_pad-edH0THtw.js";import"./merge-images-Cwm9rL5U.js";import"./vue3-tree-org-BzkJto3m.js";/* empty css                    */import"./vue-plugin-hiprint-DZDwPE-S.js";import"./jquery-VSNIoD5U.js";import"./jsbarcode-BgYCXnWS.js";import"./socket.io-client-Czs-wWz3.js";import"./engine.io-client-CYjl6Vq_.js";import"./engine.io-parser-BcOgFIoq.js";import"./@socket.io-mcuM6LAc.js";import"./debug-CmirTkX5.js";import"./ms-CufoL-nS.js";import"./socket.io-parser-CnrqkM7d.js";import"./canvg-FiHv1N34.js";import"./core-js-BJmvCVxN.js";import"./raf-B8RiLMb0.js";import"./performance-now-D4QiMMAM.js";import"./rgbcolor-Cv9DR9SS.js";import"./svg-pathdata-BQypvdxQ.js";import"./stackblur-canvas-WbqePTkn.js";import"./@vueuse-DXufPiA3.js";import"./@sxzz-D3lHDW-0.js";import"./@ctrl-D2oWfImC.js";import"./dayjs-DCN6noHZ.js";import"./async-validator-Cuo4gI4y.js";import"./memoize-one-Ds0C_khL.js";import"./normalize-wheel-es-Vn5vHDCm.js";import"./@floating-ui-DHjS97uh.js";import"./@microsoft-BNXrp5LF.js";const v=function(e){return{apiSysOnlineUserForceOfflinePost:async(a,t={})=>{const s=new URL("/api/sysOnlineUser/forceOffline","https://example.com");let o;e&&(o=e.baseOptions);const r={method:"POST",...o,...t},i={},n={};if(e&&e.accessToken){const a="function"==typeof e.accessToken?await e.accessToken():await e.accessToken;i.Authorization="Bearer "+a}i["Content-Type"]="application/json-patch+json";const l=new URLSearchParams(s.search);for(const e in n)l.set(e,n[e]);for(const e in t.params)l.set(e,t.params[e]);s.search=new URLSearchParams(l).toString();let p=o&&o.headers?o.headers:{};r.headers={...i,...p,...t.headers};const m="string"!=typeof a||"application/json"===r.headers["Content-Type"];return r.data=m?JSON.stringify(void 0!==a?a:{}):a||"",{url:s.pathname+s.search+s.hash,options:r}},apiSysOnlineUserPagePost:async(a,t={})=>{const s=new URL("/api/sysOnlineUser/page","https://example.com");let o;e&&(o=e.baseOptions);const r={method:"POST",...o,...t},i={},n={};if(e&&e.accessToken){const a="function"==typeof e.accessToken?await e.accessToken():await e.accessToken;i.Authorization="Bearer "+a}i["Content-Type"]="application/json-patch+json";const l=new URLSearchParams(s.search);for(const e in n)l.set(e,n[e]);for(const e in t.params)l.set(e,t.params[e]);s.search=new URLSearchParams(l).toString();let p=o&&o.headers?o.headers:{};r.headers={...i,...p,...t.headers};const m="string"!=typeof a||"application/json"===r.headers["Content-Type"];return r.data=m?JSON.stringify(void 0!==a?a:{}):a||"",{url:s.pathname+s.search+s.hash,options:r}}}},S=function(e){return{async apiSysOnlineUserForceOfflinePost(a,t){const s=await v(e).apiSysOnlineUserForceOfflinePost(a,t);return(e=y,a=f)=>{const t={...s.options,url:a+s.url};return e.request(t)}},async apiSysOnlineUserPagePost(a,t){const s=await v(e).apiSysOnlineUserPagePost(a,t);return(e=y,a=f)=>{const t={...s.options,url:a+s.url};return e.request(t)}}}};class O extends d{async apiSysOnlineUserForceOfflinePost(e,a){return S(this.configuration).apiSysOnlineUserForceOfflinePost(e,a).then((e=>e(this.axios,this.basePath)))}async apiSysOnlineUserPagePost(e,a){return S(this.configuration).apiSysOnlineUserPagePost(e,a).then((e=>e(this.axios,this.basePath)))}}const x={class:"sys-onlineUser-container"},N=e({__name:"index",setup(e,{expose:d}){const f=a({loading:!1,isVisible:!1,queryParams:{userName:void 0,realName:void 0},tableParams:{page:1,pageSize:10,total:1},onlineUserList:[],lastUserState:{online:!1,realName:""}});t((async()=>{P.off("OnlineUserList"),P.on("OnlineUserList",(e=>{f.onlineUserList=e.userList,f.lastUserState={online:e.online,realName:e.realName},y()})),P.off("ForceOffline"),P.on("ForceOffline",(async e=>{await P.stop(),await h(g).apiSysAuthLogoutPost(),j()}))}));const y=b((function(){U({title:"提示",message:""+(f.lastUserState.online?`【${f.lastUserState.realName}】上线了`:`【${f.lastUserState.realName}】离开了`),type:""+(f.lastUserState.online?"info":"error"),position:"bottom-right"})}),3e3,{leading:!0,trailing:!1}),v=async()=>{var e,a;f.loading=!0;let t=Object.assign(f.queryParams,f.tableParams);var s=await h(O).apiSysOnlineUserPagePost(t);f.onlineUserList=(null==(e=s.data.result)?void 0:e.items)??[],f.tableParams.total=null==(a=s.data.result)?void 0:a.total,f.loading=!1},S=()=>{f.queryParams.userName=void 0,f.queryParams.realName=void 0,v()},N=e=>{f.tableParams.pageSize=e,v()},k=e=>{f.tableParams.page=e,v()};return d({openDrawer:()=>{f.isVisible=!0,v()}}),(e,a)=>{const t=s("el-input"),d=s("el-form-item"),h=s("el-button"),g=s("el-button-group"),j=s("el-form"),y=s("el-card"),b=s("el-table-column"),U=s("el-table"),O=s("el-pagination"),z=s("el-drawer"),T=o("auth"),_=o("loading");return r(),i("div",x,[n(z,{modelValue:f.isVisible,"onUpdate:modelValue":a[4]||(a[4]=e=>f.isVisible=e),title:"在线用户列表",size:"45%"},{default:l((()=>[n(y,{shadow:"hover","body-style":{paddingBottom:"0"},style:{margin:"8px"}},{default:l((()=>[n(j,{model:f.queryParams,ref:"queryForm",inline:!0},{default:l((()=>[n(d,{label:"账号",prop:"userName"},{default:l((()=>[n(t,{placeholder:"账号",clearable:"",onKeyup:p(v,["enter"]),modelValue:f.queryParams.userName,"onUpdate:modelValue":a[0]||(a[0]=e=>f.queryParams.userName=e)},null,8,["modelValue"])])),_:1}),n(d,{label:"姓名",prop:"realName"},{default:l((()=>[n(t,{placeholder:"姓名",clearable:"",onKeyup:p(v,["enter"]),modelValue:f.queryParams.realName,"onUpdate:modelValue":a[1]||(a[1]=e=>f.queryParams.realName=e)},null,8,["modelValue"])])),_:1}),n(d,null,{default:l((()=>[n(g,null,{default:l((()=>[n(h,{type:"primary",icon:"ele-Search",onClick:v},{default:l((()=>[m(" 查询 ")])),_:1}),n(h,{icon:"ele-Refresh",onClick:S},{default:l((()=>[m(" 重置 ")])),_:1})])),_:1})])),_:1})])),_:1},8,["model"])])),_:1}),n(y,{shadow:"hover",style:{margin:"8px","padding-bottom":"15px"}},{default:l((()=>[c((r(),u(U,{data:f.onlineUserList,style:{width:"100%"},border:""},{default:l((()=>[n(b,{type:"index",label:"序号",width:"55",align:"center"}),n(b,{prop:"userName",label:"账号","header-align":"center","show-overflow-tooltip":""}),n(b,{prop:"realName",label:"姓名","header-align":"center","show-overflow-tooltip":""}),n(b,{prop:"ip",label:"IP地址","min-width":"100","header-align":"center","show-overflow-tooltip":""}),n(b,{prop:"browser",label:"浏览器","header-align":"center","show-overflow-tooltip":""}),n(b,{prop:"time",label:"登录时间","min-width":"120","header-align":"center","show-overflow-tooltip":""}),n(b,{label:"操作",width:"81",fixed:"right",align:"center","show-overflow-tooltip":""},{default:l((e=>[c((r(),u(h,{icon:"ele-CircleCloseFilled",size:"small",text:"",type:"danger",onClick:a=>(async e=>{w.confirm(`确定踢掉账号：【${e.realName}】?`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((async()=>{await P.send("ForceOffline",{connectionId:e.connectionId}).catch((function(e){}))})).catch((()=>{}))})(e.row)},{default:l((()=>[m(" 下线 ")])),_:2},1032,["onClick"])),[[T,"sysOnlineUser:forceOffline"]])])),_:1})])),_:1},8,["data"])),[[_,f.loading]]),n(O,{currentPage:f.tableParams.page,"onUpdate:currentPage":a[2]||(a[2]=e=>f.tableParams.page=e),"page-size":f.tableParams.pageSize,"onUpdate:pageSize":a[3]||(a[3]=e=>f.tableParams.pageSize=e),total:f.tableParams.total,"page-sizes":[10,20,50,100],size:"small",background:"",onSizeChange:N,onCurrentChange:k,layout:"total, sizes, prev, pager, next, jumper"},null,8,["currentPage","page-size","total"])])),_:1})])),_:1},8,["modelValue"])])}}});export{N as default};
