import{d as e,r as l,_ as a,k as t,ah as o,o as r,c as s,V as u,P as d,a as n,U as i,T as m,Q as p,W as c,u as g,O as b,S as f}from"./@vue-CX_mlhJe.js";import{e as y}from"./monaco-editor-CQECKOpe.js";import{g as v}from"./index-DWGcUZYU.js";import{S as _}from"./sys-job-api-Be8QLoLy.js";var h=(e=>(e[e.NUMBER_0=0]="NUMBER_0",e[e.NUMBER_1=1]="NUMBER_1",e[e.NUMBER_2=2]="NUMBER_2",e))(h||{});const S={class:"sys-jobDetail-container"},x={style:{color:"#fff"}},F={class:"dialog-footer"},M=e({name:"sysEditJobDetail"}),V=e({...M,props:{title:String},emits:["handleQuery"],setup(e,{expose:M,emit:V}){const U={get:'{"Method":"GET"}',post:'{"Method":"POST"}',put:'{"Method":"PUT"}',delete:'{"Method":"DELETE"}'},J=e,N=V,E=l(),R=l(),w=a({isShowDialog:!1,selectedTabName:"0",ruleForm:{},httpJobMessage:{requestUri:"",httpMethod:U.get,body:""}}),T=t((()=>null!=w.ruleForm.id&&w.ruleForm.id>0)),D=t((()=>w.ruleForm.createType===h.NUMBER_1)),B=t((()=>w.ruleForm.createType===h.NUMBER_2));var C=null;const P=()=>{w.isShowDialog=!1},k=()=>{E.value.validate((async e=>{if(e){if(w.ruleForm.createType===h.NUMBER_1?w.ruleForm.scriptCode=C.getValue():w.ruleForm.scriptCode="",w.ruleForm.createType===h.NUMBER_2){const e={HttpJob:JSON.stringify({RequestUri:w.httpJobMessage.requestUri,HttpMethod:JSON.parse(w.httpJobMessage.httpMethod+""),Body:w.httpJobMessage.body,ClientName:"HttpJob",EnsureSuccessStatusCode:!0})};w.ruleForm.properties=JSON.stringify(e)}null!=w.ruleForm.id&&w.ruleForm.id>0?await v(_).apiSysJobUpdateJobDetailPost(w.ruleForm):await v(_).apiSysJobAddJobDetailPost(w.ruleForm),N("handleQuery"),w.isShowDialog=!1}}))},q=e=>{if(null==e||""===e)return{};const l=JSON.parse(e),a=JSON.parse(l.HttpJob);return{requestUri:a.RequestUri,httpMethod:JSON.stringify(a.HttpMethod),body:a.Body}};return M({httpMethodDef:U,openDialog:e=>{var l;w.selectedTabName="0",w.ruleForm=JSON.parse(JSON.stringify(e)),w.isShowDialog=!0,null==(l=E.value)||l.resetFields(),e.id&&w.ruleForm.createType===h.NUMBER_2&&(w.httpJobMessage=q(w.ruleForm.properties)),setTimeout((()=>{null==C&&(C=y.create(R.value,{theme:"vs-dark",value:"",language:"csharp",formatOnPaste:!0,wordWrap:"on",wrappingIndent:"indent",folding:!0,foldingHighlight:!0,foldingStrategy:"indentation",showFoldingControls:"always",disableLayerHinting:!0,emptySelectionClipboard:!1,selectionClipboard:!1,automaticLayout:!0,codeLens:!1,scrollBeyondLastLine:!1,colorDecorators:!0,accessibilitySupport:"auto",lineNumbers:"on",lineNumbersMinChars:5,readOnly:!1})),C.setValue(null==e.id?'#region using\n\nusing Furion;\nusing Furion.Logging;\nusing Furion.RemoteRequest.Extensions;\nusing Furion.Schedule;\nusing Microsoft.Extensions.DependencyInjection;\nusing System;\nusing System.Data;\nusing System.Linq.Dynamic.Core;\nusing System.Linq.Expressions;\nusing System.Text;\nusing System.Threading;\nusing System.Threading.Tasks;\nusing Yitter.IdGenerator;\n\n#endregion\n\nnamespace Site.NET.Core;\n\n/// <summary>\n/// 动态作业任务\n/// </summary>\n[JobDetail("你的作业编号")]\npublic class DynamicJob : IJob\n{\n    private readonly IServiceProvider _serviceProvider;\n\n    public DynamicJob(IServiceProvider serviceProvider)\n    {\n        _serviceProvider = serviceProvider;\n    }\n\n    public async Task ExecuteAsync(JobExecutingContext context, CancellationToken stoppingToken)\n    {\n        using var serviceScope = _serviceProvider.CreateScope();\n        \n        // 获取用户仓储\n        // var rep = serviceScope.ServiceProvider.GetService<SqlSugarRepository<SysUser>>();\n\n        // 请求网址\n        // var result = await "http://www.baidu.com".GetAsStringAsync();\n        // Console.WriteLine(result);\n\n        // 日志\n        // Log.Information("日志消息");\n    }\n}':w.ruleForm.scriptCode)}),1)},getHttpJobMessage:q}),(e,l)=>{const a=o("ele-Edit"),t=o("el-icon"),y=o("el-input"),v=o("el-form-item"),_=o("el-col"),M=o("el-radio"),V=o("el-radio-group"),N=o("SvgIcon"),C=o("el-tooltip"),q=o("el-row"),O=o("el-form"),I=o("el-tab-pane"),L=o("el-tabs"),j=o("el-button"),H=o("el-dialog");return r(),s("div",S,[u(H,{modelValue:w.isShowDialog,"onUpdate:modelValue":l[11]||(l[11]=e=>w.isShowDialog=e),draggable:"","close-on-click-modal":!1,width:"900px"},{header:d((()=>[n("div",x,[u(t,{size:"16",style:{"margin-right":"3px",display:"inline","vertical-align":"middle"}},{default:d((()=>[u(a)])),_:1}),n("span",null,i(J.title),1)])])),footer:d((()=>[n("span",F,[u(j,{onClick:P},{default:d((()=>[m("取 消")])),_:1}),u(j,{type:"primary",onClick:k},{default:d((()=>[m("确 定")])),_:1})])])),default:d((()=>[u(L,{modelValue:w.selectedTabName,"onUpdate:modelValue":l[10]||(l[10]=e=>w.selectedTabName=e)},{default:d((()=>[u(I,{label:"作业信息"},{default:d((()=>[u(O,{model:w.ruleForm,ref_key:"ruleFormRef",ref:E,"label-width":"auto",style:{height:"500px"}},{default:d((()=>[u(q,{gutter:35},{default:d((()=>[u(_,{xs:24,sm:12,md:12,lg:12,xl:12,class:"mb20"},{default:d((()=>[u(v,{label:"作业编号",prop:"jobId",rules:[{required:!0,message:"作业编号不能为空",trigger:"blur"}]},{default:d((()=>[u(y,{modelValue:w.ruleForm.jobId,"onUpdate:modelValue":l[0]||(l[0]=e=>w.ruleForm.jobId=e),placeholder:"作业编号",disabled:T.value,clearable:""},null,8,["modelValue","disabled"])])),_:1})])),_:1}),u(_,{xs:24,sm:12,md:12,lg:12,xl:12,class:"mb20"},{default:d((()=>[u(v,{label:"组名称",prop:"groupName",rules:[{required:!0,message:"组名称不能为空",trigger:"blur"}]},{default:d((()=>[u(y,{modelValue:w.ruleForm.groupName,"onUpdate:modelValue":l[1]||(l[1]=e=>w.ruleForm.groupName=e),placeholder:"组名称",clearable:""},null,8,["modelValue"])])),_:1})])),_:1}),u(_,{xs:24,sm:24,md:24,lg:24,xl:24,class:"mb20"},{default:d((()=>[u(v,{label:"创建类型"},{default:d((()=>[u(V,{modelValue:w.ruleForm.createType,"onUpdate:modelValue":l[2]||(l[2]=e=>w.ruleForm.createType=e),disabled:T.value},{default:d((()=>[p(u(M,{value:g(h).NUMBER_0},{default:d((()=>[m("内置")])),_:1},8,["value"]),[[c,T.value]]),u(M,{value:g(h).NUMBER_1},{default:d((()=>[m("脚本")])),_:1},8,["value"]),u(M,{value:g(h).NUMBER_2},{default:d((()=>[m("Http请求")])),_:1},8,["value"])])),_:1},8,["modelValue","disabled"])])),_:1})])),_:1}),u(_,{xs:24,sm:12,md:12,lg:12,xl:12,class:"mb20"},{default:d((()=>[u(v,{label:"执行方式"},{default:d((()=>[u(V,{modelValue:w.ruleForm.concurrent,"onUpdate:modelValue":l[3]||(l[3]=e=>w.ruleForm.concurrent=e)},{default:d((()=>[u(M,{value:!0},{default:d((()=>[m("并行")])),_:1}),u(M,{value:!1},{default:d((()=>[m("串行")])),_:1})])),_:1},8,["modelValue"])])),_:1})])),_:1}),p(u(_,{xs:24,sm:12,md:12,lg:12,xl:12,class:"mb20"},{default:d((()=>[u(v,{prop:"includeAnnotation"},{label:d((()=>[n("div",null,[m(" 扫描触发器 "),u(C,{"raw-content":"",content:"此参数只在新增作业时生效<br/>扫描定义在作业上的触发器",placement:"top"},{default:d((()=>[u(N,{name:"fa fa-question-circle-o",size:16,style:{"vertical-align":"middle"}})])),_:1})])])),default:d((()=>[u(V,{modelValue:w.ruleForm.includeAnnotation,"onUpdate:modelValue":l[4]||(l[4]=e=>w.ruleForm.includeAnnotation=e)},{default:d((()=>[u(M,{value:!0},{default:d((()=>[m("是")])),_:1}),u(M,{value:!1},{default:d((()=>[m("否")])),_:1})])),_:1},8,["modelValue"])])),_:1})])),_:1},512),[[c,!T.value&&!B.value]]),u(_,{xs:24,sm:24,md:24,lg:24,xl:24,class:"mb20"},{default:d((()=>[u(v,{label:"描述信息"},{default:d((()=>[u(y,{modelValue:w.ruleForm.description,"onUpdate:modelValue":l[5]||(l[5]=e=>w.ruleForm.description=e),placeholder:"描述信息",clearable:"",type:"textarea",autosize:{minRows:1,maxRows:3}},null,8,["modelValue"])])),_:1})])),_:1}),B.value?f("",!0):(r(),b(_,{key:0,xs:24,sm:24,md:24,lg:24,xl:24,class:"mb20"},{default:d((()=>[u(v,{label:"额外数据"},{default:d((()=>[u(y,{modelValue:w.ruleForm.properties,"onUpdate:modelValue":l[6]||(l[6]=e=>w.ruleForm.properties=e),placeholder:"额外数据",clearable:"",type:"textarea",autosize:{minRows:3,maxRows:6}},null,8,["modelValue"])])),_:1})])),_:1})),B.value?(r(),b(_,{key:1,xs:24,sm:24,md:24,lg:24,xl:24,class:"mb20"},{default:d((()=>[u(v,{label:"请求地址"},{default:d((()=>[u(y,{modelValue:w.httpJobMessage.requestUri,"onUpdate:modelValue":l[7]||(l[7]=e=>w.httpJobMessage.requestUri=e),placeholder:"请求地址",clearable:""},null,8,["modelValue"])])),_:1})])),_:1})):f("",!0),B.value?(r(),b(_,{key:2,xs:24,sm:24,md:24,lg:24,xl:24,class:"mb20"},{default:d((()=>[u(v,{label:"请求方法"},{default:d((()=>[u(V,{modelValue:w.httpJobMessage.httpMethod,"onUpdate:modelValue":l[8]||(l[8]=e=>w.httpJobMessage.httpMethod=e)},{default:d((()=>[u(M,{value:U.get},{default:d((()=>[m("Get")])),_:1},8,["value"]),u(M,{value:U.post},{default:d((()=>[m("Post")])),_:1},8,["value"]),u(M,{value:U.put},{default:d((()=>[m("Put")])),_:1},8,["value"]),u(M,{value:U.delete},{default:d((()=>[m("Delete")])),_:1},8,["value"])])),_:1},8,["modelValue"])])),_:1})])),_:1})):f("",!0),B.value?(r(),b(_,{key:3,xs:24,sm:24,md:24,lg:24,xl:24,class:"mb20"},{default:d((()=>[u(v,{label:"请求报文体"},{default:d((()=>[u(y,{modelValue:w.httpJobMessage.body,"onUpdate:modelValue":l[9]||(l[9]=e=>w.httpJobMessage.body=e),placeholder:"请求报文体",clearable:"",type:"textarea",autosize:{minRows:3,maxRows:6}},null,8,["modelValue"])])),_:1})])),_:1})):f("",!0)])),_:1})])),_:1},8,["model"])])),_:1}),u(I,{label:"脚本代码",disabled:!D.value},{default:d((()=>[n("div",{ref_key:"monacoEditorRef",ref:R,style:{width:"100%",height:"500px"}},null,512)])),_:1},8,["disabled"])])),_:1},8,["modelValue"])])),_:1},8,["modelValue"])])}}});export{h as J,V as _};
