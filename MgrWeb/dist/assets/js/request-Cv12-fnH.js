import{a as e}from"./axios-CURSphCx.js";import{L as r,b as o}from"./index-DWGcUZYU.js";import{E as t}from"./element-plus-B9gGnqkL.js";const s=e.create({baseURL:window.__env__.VITE_API_URL,timeout:18e5,headers:{"Content-Type":"application/json"}}),n="access-token",a=`x-${n}`,i=()=>{r.remove(n),r.remove(a),o.clear(),window.location.reload()};s.interceptors.request.use((e=>{var o;const t=r.get(n);if(t){e.headers.Authorization=`Bearer ${t}`;const n=function(e){e=e.replace(/_/g,"/").replace(/-/g,"+");var r=decodeURIComponent(escape(window.atob(e.split(".")[1])));return JSON.parse(r)}(t),i=(s=n.exp,new Date(1e3*s));if(new Date>=i){const o=r.get(a);o&&(e.headers["X-Authorization"]=`Bearer ${o}`)}if("get"===(null==(o=e.method)?void 0:o.toLowerCase())&&e.data){let r=e.url+"?"+function(e){let r="";for(const t of Object.keys(e)){const s=e[t];var o=encodeURIComponent(t)+"=";if(null!==s&&""!==s&&void 0!==s)if("object"==typeof s){for(const e of Object.keys(s))if(null!==s[e]&&""!==s[e]&&void 0!==s[e]){r+=encodeURIComponent(t+"["+e+"]")+"="+encodeURIComponent(s[e])+"&"}}else r+=o+encodeURIComponent(s)+"&"}return r}(e.data);r=r.slice(0,-1),e.data={},e.url=r}}var s;return e}),(e=>Promise.reject(e))),s.interceptors.response.use((e=>{var o=e.status,s=e.data;if(401===o&&i(),o>=400)throw new Error(e.statusText||"Request Error.");if(s&&s.hasOwnProperty("errors")&&s.errors)throw new Error(JSON.stringify(s.errors||"Request Error."));var c=e.headers[n],d=e.headers[a];if("invalid_token"===c?i():d&&c&&"invalid_token"!==c&&(r.set(n,c),r.set(a,d)),401===s.code)i();else{if(void 0===s.code)return Promise.resolve(e);var p;if(200!==s.code)throw p=s.message&&"object"==typeof s.message?JSON.stringify(s.message):s.message,t({dangerouslyUseHTMLString:!0,message:p,type:"error"}),new Error(p)}return e}),(e=>(e.response&&401===e.response.status&&i(),-1!=e.message.indexOf("timeout")?t.error("网络超时"):"Network Error"==e.message?t.error("网络连接错误"):e.response.data?t.error(e.response.statusText):t.error("接口路径找不到"),Promise.reject(e))));const c=s;export{c as r};
