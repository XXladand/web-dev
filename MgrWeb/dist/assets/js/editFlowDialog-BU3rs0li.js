import{l as e,L as t,B as o,I as s,M as r,a,S as l,b as i}from"./@logicflow-CF0QjZ9u.js";import n from"./PanelNode-B1rMdpDC.js";import d from"./PanelControl-lfuY-SGK.js";import{_ as c}from"./PanelDataDialog.vue_vue_type_script_setup_true_lang-DSCAWjNb.js";import p from"./PropertyDialog-CBR2Suvt.js";import{g as u}from"./index-DWGcUZYU.js";import{A as h}from"./approval-flow-api-BPCG1yJd.js";import{c as m}from"./element-plus-B9gGnqkL.js";import{d as g,r as v,_ as f,ah as y,o as x,c as j,V as S,P as k,a as N,U as b,u as w,T as D,O as _,S as A,n as C}from"./@vue-CX_mlhJe.js";import{_ as M}from"./_plugin-vue_export-helper-BCo6x5W8.js";import"./@babel-Q_QrznUx.js";import"./preact-26HT5LyJ.js";import"./lodash-es-Bx2dc0Qf.js";import"./vue-json-pretty-C2Gqq-RF.js";import"./PropertyCommon.vue_vue_type_script_setup_true_lang-PbkQhNEZ.js";import"./pinia-CUaEdNPK.js";import"./vue-demi-DMxTsK9-.js";import"./vue-DMOwXDUL.js";import"./jspdf-CH-AZmyM.js";import"./fflate-B3Xb404m.js";import"./vue-router-DCQgfElv.js";import"./vue-i18n-DOLUIXgH.js";import"./@intlify-8Jop7_C0.js";import"./js-cookie-BXEMiIsG.js";import"./@element-plus-BOmeTCVz.js";import"./nprogress-BXoedg-7.js";import"./axios-CURSphCx.js";import"./mitt-CNZ6avp8.js";import"./vue-grid-layout-DUD0Qdrs.js";import"./vform3-builds-n_pM9nIF.js";import"./vue-signature-pad-lyh4QR3Z.js";import"./signature_pad-edH0THtw.js";import"./merge-images-Cwm9rL5U.js";import"./vue3-tree-org-BzkJto3m.js";/* empty css                    */import"./vue-plugin-hiprint-DZDwPE-S.js";import"./jquery-VSNIoD5U.js";import"./jsbarcode-BgYCXnWS.js";import"./socket.io-client-Czs-wWz3.js";import"./engine.io-client-CYjl6Vq_.js";import"./engine.io-parser-BcOgFIoq.js";import"./@socket.io-mcuM6LAc.js";import"./debug-CmirTkX5.js";import"./ms-CufoL-nS.js";import"./socket.io-parser-CnrqkM7d.js";import"./canvg-FiHv1N34.js";import"./core-js-BJmvCVxN.js";import"./raf-B8RiLMb0.js";import"./performance-now-D4QiMMAM.js";import"./rgbcolor-Cv9DR9SS.js";import"./svg-pathdata-BQypvdxQ.js";import"./stackblur-canvas-WbqePTkn.js";import"./@vueuse-DXufPiA3.js";import"./@sxzz-D3lHDW-0.js";import"./@ctrl-D2oWfImC.js";import"./dayjs-DCN6noHZ.js";import"./async-validator-Cuo4gI4y.js";import"./memoize-one-Ds0C_khL.js";import"./normalize-wheel-es-Vn5vHDCm.js";import"./@floating-ui-DHjS97uh.js";class I extends e.BezierEdge{}class P extends e.BezierEdgeModel{getEdgeStyle(){const e=super.getEdgeStyle();return e.strokeWidth=1,e.stroke="#ababac",e}getData(){const e=super.getData();return e.sourceAnchorId=this.sourceAnchorId,e.targetAnchorId=this.targetAnchorId,e}updatePathByAnchor(){const e=this.graphModel.getNodeModelById(this.sourceNodeId).getDefaultAnchor().find((e=>e.id===this.sourceAnchorId)),t=this.graphModel.getNodeModelById(this.targetNodeId).getDefaultAnchor().find((e=>e.id===this.targetAnchorId)),o={x:e.x,y:e.y};this.updateStartPoint(o);const s={x:t.x,y:t.y};this.updateEndPoint(s),this.pointsList=[],this.initPoints()}}const z={type:"edge-sql",view:I,model:P},E=e=>{e.register(z)};class O extends e.CircleNode{getLabelShape(){const{model:t}=this.props,{x:o,y:s}=t;return e.h("text",{fill:"#000000",fontSize:12,x:o-12,y:s+4,width:50,height:25},"Start")}getShape(){const{model:t}=this.props,{x:o,y:s,r:r}=t,{fill:a,stroke:l,strokeWidth:i}=t.getNodeStyle();return e.h("g",{},[e.h("circle",{cx:o,cy:s,r:r,fill:a,stroke:l,strokeWidth:i}),this.getLabelShape()])}}class V extends e.CircleNodeModel{initNodeData(e){e.text={value:e.text&&e.text.value||"",x:e.x,y:e.y+35,dragable:!1,editable:!0},super.initNodeData(e),this.r=20}getNodeStyle(){return super.getNodeStyle()}getAnchorStyle(){const e=super.getAnchorStyle();return e.hover.r=8,e.hover.fill="rgb(24, 125, 255)",e.hover.stroke="rgb(24, 125, 255)",e}getOutlineStyle(){const e=super.getOutlineStyle();return e.stroke="#88f",e}getConnectedTargetRules(){const e=super.getConnectedTargetRules();return e.push({message:"起始节点不能作为连线的终点",validate:()=>!1}),e}}const T={type:"start-node",view:O,model:V};class B extends e.CircleNode{getIconShape(){const{model:t}=this.props,{x:o,y:s,width:r,height:a}=t,l="#404040";return e.h("svg",{x:o-r/2,y:s-a/2,width:40,height:40,viewBox:"0 0 1024 1024"},e.h("path",{fill:l,d:"M212.992 526.336 212.992 526.336 212.992 526.336 215.04 526.336 212.992 526.336Z"}),e.h("path",{fill:l,d:"M724.992 296.96 724.992 296.96 296.96 296.96 296.96 724.992 724.992 724.992 724.992 296.96Z"}))}getShape(){const{model:t}=this.props,{x:o,y:s,r:r}=t,{fill:a,stroke:l,strokeWidth:i}=t.getNodeStyle();return e.h("g",{},[e.h("circle",{cx:o,cy:s,r:r,fill:a,stroke:l,strokeWidth:i}),this.getIconShape()])}}class F extends e.CircleNodeModel{initNodeData(e){e.text={value:e.text&&e.text.value||"",x:e.x,y:e.y+35},super.initNodeData(e),this.r=20}getAnchorStyle(){const e=super.getAnchorStyle();return e.hover.r=8,e.hover.fill="rgb(24, 125, 255)",e.hover.stroke="rgb(24, 125, 255)",e}getOutlineStyle(){const e=super.getOutlineStyle();return e.stroke="#88f",e}getConnectedSourceRules(){const e=super.getConnectedSourceRules();return e.push({message:"终止节点不能作为连线的起点",validate:()=>!1}),e}}const H={type:"end-node",view:B,model:F};class W extends e.RectNode{getShare(){const{model:t}=this.props,{width:o,height:s,x:r,y:a}=t,l={x:r-o/2,y:a-s/2},i=t.getNodeStyle();return e.h("rect",{...i,...l})}}class R extends e.RectNodeModel{constructor(e,t){super(e,t),this.radius=20}}const $={type:"task-node",view:W,model:R};class L extends e.PolygonNode{getIconShape(){const{model:t}=this.props,{stroke:o}=t.getNodeStyle();return e.h("svg",{x:20,y:18,width:30,height:30,viewBox:"0 0 1126 1024"},e.h("path",{fill:o,d:"M792.576 379.392a25.6 25.6 0 0 0 25.2928 25.8048h283.2384A25.6 25.6 0 0 0 1126.4 379.392a25.6 25.6 0 0 0-25.2928-25.8048h-283.2384a25.6 25.6 0 0 0-25.344 25.8048z m303.9232 80.7424H761.856c-16.5376 0-29.9008 11.6224-29.9008 25.7536 0 14.1824 13.312 25.7536 29.9008 25.7536h334.6432c16.4864 0 29.9008-11.5712 29.9008-25.7536 0-14.1312-13.4144-25.7536-29.9008-25.7536z m4.608 106.496h-283.2384a25.6 25.6 0 0 0-25.344 25.7536 25.6 25.6 0 0 0 25.344 25.7536h283.2384A25.6 25.6 0 0 0 1126.4 592.384a25.6 25.6 0 0 0-25.2928-25.8048zM543.0272 1024H341.6576C150.8352 1024 0 1024 0 923.648v-20.1216c0-188.16 153.2928-341.1968 341.7088-341.1968h201.2672c188.416 0 341.76 153.0368 341.76 341.1968v20.0704C884.6848 1024 726.3232 1024 542.976 1024z m-203.1616-405.1456c-158.464 0-287.4368 128.4096-287.4368 286.208v20.48c0 40.9088 166.0928 40.9088 287.4368 40.9088h204.9536c100.4544 0 287.4368 0 287.4368-40.96v-20.3776c0-157.8496-128.9728-286.208-287.4368-286.208H339.8656z m92.416-76.7488a271.4112 271.4112 0 0 1-271.2064-271.0528A271.36 271.36 0 0 1 432.2816 0a271.36 271.36 0 0 1 271.2064 271.0528 271.4624 271.4624 0 0 1-271.2064 271.0528z m-215.3472-271.872c0 118.1696 96.6144 214.3232 215.3472 214.3232 118.784 0 215.3984-96.1536 215.3984-214.3232 0-118.2208-96.6144-214.3232-215.3984-214.3232S216.9344 152.0128 216.9344 270.2336z"}))}getShape(){const{model:t}=this.props,{width:o,height:s,x:r,y:a,points:l}=t,{fill:i,fillOpacity:n,strokeWidth:d,stroke:c,strokeOpacity:p}=t.getNodeStyle(),u=`matrix(1 0 0 1 ${r-o/2} ${a-s/2})`,h=l.map((e=>e.join(","))).join(" ");return e.h("g",{transform:u},[e.h("polygon",{points:h,fill:i,stroke:c,strokeWidth:d,strokeOpacity:p,fillOpacity:n}),this.getIconShape()])}}class U extends e.PolygonNodeModel{constructor(e,t){e.text={value:e.text&&e.text.value||"",x:e.x,y:e.y+50},super(e,t),this.menu=[{className:"lf-menu-delete",text:"delete",callback(e){lf.deleteNode(e.id)}},{text:"edit",className:"lf-menu-item",callback(e){lf.editText(e.id)}},{text:"copy",className:"lf-menu-item",callback(e){lf.cloneNode(e.id)}}]}initNodeData(e){super.initNodeData(e);const t=35;this.points=[[t,0],[70,t],[t,70],[0,t]]}getAnchorStyle(){const e=super.getAnchorStyle();return e.hover.r=8,e.hover.fill="rgb(24, 125, 255)",e.hover.stroke="rgb(24, 125, 255)",e}}const q={type:"user-node",view:L,model:U};class G extends e.HtmlNode{getAnchorShape(t){const{x:o,y:s,type:r}=t;return e.h("rect",{x:o-5,y:s-5,width:10,height:10,className:"custom-anchor "+("left"===r?"incomming-anchor":"outgoing-anchor")})}setHtml(e){e.innerHTML="";const{properties:{fields:t,tableName:o}}=this.props.model;e.setAttribute("class","table-container");const s=document.createElement("div");s.className=`table-node table-color-${Math.ceil(4*Math.random())}`;const r=document.createElement("div");r.innerText=o,r.className="table-name",s.appendChild(r);const a=document.createDocumentFragment();for(let l=0;l<t.length;l++){const e=t[l],o=document.createElement("div");o.className="table-feild";const s=document.createElement("span");s.innerText=e.key;const r=document.createElement("span");r.innerText=e.type,r.className="feild-type",o.appendChild(s),o.appendChild(r),a.appendChild(o)}s.appendChild(a),e.appendChild(s)}}class J extends e.HtmlNodeModel{addField(e){this.properties.fields.unshift(e),this.setAttributes(),this.move(0,12),this.incoming.edges.forEach((e=>{e.updatePathByAnchor()})),this.outgoing.edges.forEach((e=>{e.updatePathByAnchor()}))}getOutlineStyle(){const e=super.getOutlineStyle();return e.stroke="none",e.hover.stroke="none",e}getAnchorStyle(e){const t=super.getAnchorStyle();return"left"===e.type?(t.fill="red",t.hover.fill="transparent",t.hover.stroke="transpanrent",t.className="lf-hide-default"):t.fill="green",t}setAttributes(){this.width=200;const{properties:{fields:e}}=this;this.height=60+24*e.length;this.sourceRules.push({message:"只允许从右边的锚点连出",validate:(e,t,o)=>"right"===o.type}),this.targetRules.push({message:"只允许连接左边的锚点",validate:(e,t,o,s)=>"left"===s.type})}getDefaultAnchor(){const{id:e,x:t,y:o,width:s,height:r,isHovered:a,isSelected:l,properties:{fields:i,isConnection:n}}=this,d=[];return i.forEach(((i,c)=>{(n||!a&&!l)&&d.push({x:t-s/2+10,y:o-r/2+60+24*c,id:`${e}_${i.key}_left`,edgeAddable:!1,type:"left"}),n||d.push({x:t+s/2-10,y:o-r/2+60+24*c,id:`${e}_${i.key}_right`,type:"right"})})),d}}const K={type:"sql-node",model:J,view:G},Z=e=>{e.register(T),e.register(H),e.register($),e.register(q),e.register(K)},Q={class:"flow-container"},X={style:{color:"#fff"}},Y={class:"f-content"},ee={class:"f-container"},te={class:"f-switch"},oe={class:"f-container-c",ref:"container",id:"container"},se={class:"dialog-footer"},re=M(g({__name:"editFlowDialog",props:{title:{type:String,default:""}},emits:["reloadTable","updateFlow"],setup(e,{expose:g,emit:M}){var I=e;const P=M,z=v({}),O=v(),V=v(!1),T=v("rtl"),B=v(!1),F=f({loading:!1,isShowDialog:!1,ruleSource:{},nodeData:{},graphData:{}}),H=()=>{F.isShowDialog=!1},W=async()=>{var e;z.value=null==(e=O.value)?void 0:e.getGraphData(),F.ruleSource.flowJson=JSON.stringify(z.value),await u(h).apiApprovalFlowUpdatePost(F.ruleSource),P("updateFlow",z.value),P("reloadTable"),F.isShowDialog=!1},R=()=>{const e=document.querySelector("#container");O.value=new t({stopScrollGraph:!0,stopZoomGraph:!0,metaKeyMultipleSelected:!0,grid:{size:10,type:"dot"},keyboard:{enabled:!0},snapline:!0,plugins:[o,s,r,a,l,i],container:e,width:e.clientWidth,height:e.clientHeight}),O.value.setTheme({snapline:{stroke:"#1E90FF",strokeWidth:1}}),Z(O.value),E(O.value),O.value.on("node:click",(({data:e})=>{F.nodeData=e,V.value=!0})),O.value.on("edge:click",(({data:e})=>{F.nodeData=e,V.value=!0})),O.value.render(z.value),O.value.focusOn({coordinate:{x:300,y:300}})},$=e=>{var t,o;e?null==(t=O.value)||t.extension.selectionSelect.openSelectionSelect():null==(o=O.value)||o.extension.selectionSelect.closeSelectionSelect()},L=()=>{var e,t=null==(e=O.value)?void 0:e.getGraphData();F.graphData=t,B.value=!0},U=e=>{m.confirm("确认要关闭当前属性编辑?").then((()=>{e()})).catch((()=>{}))};return g({openDialog:e=>{F.ruleSource=e,F.ruleSource.flowJson?z.value=JSON.parse(F.ruleSource.flowJson):z.value={nodes:[],edges:[]},F.isShowDialog=!0,C((()=>{R()}))}}),(e,t)=>{const o=y("el-switch"),s=y("el-drawer"),r=y("el-dialog"),a=y("el-button");return x(),j("div",Q,[S(r,{modelValue:F.isShowDialog,"onUpdate:modelValue":t[3]||(t[3]=e=>F.isShowDialog=e),draggable:"","close-on-click-modal":!1,fullscreen:""},{header:k((()=>[N("div",X,[N("span",null,b(w(I).title),1)])])),footer:k((()=>[N("span",se,[S(a,{onClick:H},{default:k((()=>[D("取 消")])),_:1}),S(a,{type:"primary",onClick:W},{default:k((()=>[D("确 定")])),_:1})])])),default:k((()=>[N("div",Y,[N("div",ee,[N("div",te,[S(o,{modelValue:F.value2,"onUpdate:modelValue":t[0]||(t[0]=e=>F.value2=e),onChange:$,class:"mb-2","active-text":"打开框选","inactive-text":"关闭框选"},null,8,["modelValue"])]),O.value?(x(),_(d,{key:0,lf:O.value,onCatData:L},null,8,["lf"])):A("",!0),N("div",oe,null,512),O.value?(x(),_(n,{key:1,lf:O.value},null,8,["lf"])):A("",!0),S(s,{title:"属性",modelValue:V.value,"onUpdate:modelValue":t[1]||(t[1]=e=>V.value=e),direction:T.value,size:"500px","before-close":U},{default:k((()=>[V.value?(x(),_(p,{key:0,nodeData:F.nodeData,lf:O.value,onSetPropertiesFinish:U},null,8,["nodeData","lf"])):A("",!0)])),_:1},8,["modelValue","direction"]),S(r,{title:"数据",modelValue:B.value,"onUpdate:modelValue":t[2]||(t[2]=e=>B.value=e),width:"50%"},{default:k((()=>[S(c,{graphData:F.graphData},null,8,["graphData"])])),_:1},8,["modelValue"])])])])),_:1},8,["modelValue"])])}}}),[["__scopeId","data-v-d77993bf"]]);export{re as default};
